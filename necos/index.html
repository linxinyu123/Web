<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Neco's Custom Cake</title>
<link rel="icon" type="image/png" href="https://lestoy.com/necos/f.png" />
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">
<style>
        /* --- 1. è®¾è®¡ç³»ç»Ÿ --- */
        :root {
            --primary: #102940; /* æ·±è“ */
            --accent: #F4C04B; /* è›‹é»„ */
            --bg: #F5F5F7; /* ç±³ç™½ */
            --white: #FFFFFF;
            --text-gray: #666666;
            --border: #F0F0F0;
            --radius-box: 20px;
            --radius-btn: 50px;
            --shadow: 0 8px 24px rgba(16, 41, 64, 0.08);
            --header-h: 70px;
        }
        /* å¼¹çª—æ‰“å¼€æ—¶ï¼šé”ä½èƒŒæ™¯æ»šåŠ¨ï¼ˆå« iOSï¼‰ */
        body.modal-open{
            overflow: hidden;
            position: fixed;
            width: 100%;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body, button, input, select, textarea {
            font-family: 'Nunito', sans-serif;
        }
        html {
          overflow-y: scroll;
        }
        body {
            background-color: var(--bg);
            color: var(--primary);
            margin: 0;
            padding-top: var(--header-h);
            padding-bottom: 82px;
            overflow-x: hidden;
        }
        /* --- 2. Header --- */
        .smart-header {
            position: fixed; top: 0; left: 0; right: 0; height: var(--header-h);
            background: var(--white); z-index: 900;
            box-shadow: 0 2px 10px rgba(0,0,0,0.03);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 20px;
        }
        .header-left { display: flex; align-items: center; gap: 15px; }
        .logo-img { height: 54px; width: auto; }
        .lang-switch { display: flex; background: #F3F4F6; border-radius: 20px; padding: 3px; }
        .lang-btn {
            border: none; background: transparent; padding: 6px 10px;
            border-radius: 16px; font-size: 12px; font-weight: 800; color: #999;
            cursor: pointer; transition: all 0.2s;
        }
        .lang-btn.active { background: var(--accent); color: var(--primary); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        /* --- 3. å¸ƒå±€ --- */
        .container { max-width: 1000px; margin: 0 auto; padding: 20px; }
        .view-section { display: none; }
        .view-section.active { display: block; }
        
        /* [NEW] å¸¸é©»æœç´¢æ¡† (Google Style) */
        .search-hero { margin-bottom: 30px; }
        .search-hero-inner {
            display: flex; align-items: center; gap: 12px;
            background: var(--white); border-radius: 18px;
            padding: 18px 18px;
            box-shadow: 0 8px 24px rgba(16, 41, 64, 0.08);
            transition: box-shadow 0.2s;
        }
        .search-hero-inner:focus-within { box-shadow: 0 8px 30px rgba(16, 41, 64, 0.15); }
      .search-icon {
        width: 20px;
        height: 20px;
        background-color: #999;
        -webkit-mask: url("https://lestoy.com/love/icones/search.svg") no-repeat center;
        -webkit-mask-size: contain;
        mask: url("https://lestoy.com/love/icones/search.svg") no-repeat center;
        mask-size: contain;
        display: inline-block;
      }
      .search-hero-inner:has(#search-input:not(:placeholder-shown)) .search-icon{
        background-color: var(--primary);
        color: var(--primary);
      }
      #search-input:placeholder-shown ~ .search-clear{
        opacity:0;
        pointer-events:none;
      }
        .search-input {
            flex: 1; border: none; outline: none; background: transparent;
            font-size: 16px; font-family: 'Nunito', sans-serif; font-weight: 600;
            color: var(--primary);
        }
        .search-input::placeholder { color: #999; }
        .search-clear { cursor: pointer; color:var(--primary); font-size: 18px; display: none; }
        input[type="search"]::-webkit-search-cancel-button {
          -webkit-appearance: none;
          appearance: none;
          display: none;
        }
        input[type="search"]::-webkit-search-decoration {
          -webkit-appearance: none;
        }
        /* --- 4. é¦–é¡µåˆ†ç±» --- */
        .category-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 25px;
        }
        .cat-card {
            background: var(--white); border-radius: var(--radius-box);
            overflow: hidden; box-shadow: var(--shadow);
            cursor: pointer; transition: transform 0.2s;
            display: flex; flex-direction: column;
        }
        .cat-card:active { transform: scale(0.98); }
        .cat-img-box { width: 100%; height: 200px; overflow: hidden; }
        .cat-img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.5s; }
        .cat-card:hover .cat-img { transform: scale(1.05); }
        .cat-info { padding: 20px; border-top: 1px solid var(--border); }
        .cat-title { font-size: 20px; font-weight: 900; margin: 0 0 6px 0; color: var(--primary); }
        .cat-desc { font-size: 14px; color: var(--text-gray); line-height: 1.4; }
        /* --- 5. åˆ—è¡¨é¡µ --- */
        .back-nav {
          display: flex;
          align-items: center;
          gap: 12px;
          margin-bottom: 20px;
        }
        .nav-title {
          font-size: 15px;
          font-weight: 600;
          color: #6e6e73;
          white-space: nowrap;
        }
        .btn-back {
            background: var(--white); border: 1px solid #E5E7EB;
            padding: 12px 24px 12px 18.5px; border-radius: var(--radius-btn);
            display: inline-flex; align-items: center; gap: 8px;
            font-weight: 800; font-size: 16px; color: var(--primary); cursor: pointer;
        }
        .back-nav {
          --nav-icon: url("https://i.ibb.co/Q3hkmW9x/IMG-20251219-145724.png");
          --nav-icon-size: 22px;
        }
        .back-icon {
          width: var(--nav-icon-size);
          height: var(--nav-icon-size);
          background-color: currentColor;
          -webkit-mask: var(--nav-icon) no-repeat center;
          -webkit-mask-size: contain;
          mask: var(--nav-icon) no-repeat center;
          mask-size: contain;
          display: inline-block;
        }
        .product-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        .prod-card {
            background: var(--white); border-radius: var(--radius-box); overflow: hidden;
            box-shadow: var(--shadow); display: flex; flex-direction: column;
        }
        .prod-img { width: 100%; height: 220px; object-fit: cover; }
        .prod-body { padding: 18px; flex: 1; display: flex; flex-direction: column; }
        .prod-title { font-size: 18px; font-weight: 800; margin: 0 0 8px 0; color: var(--primary); }
        .prod-desc {
            font-size: 13px; color: var(--text-gray); line-height: 1.5;
            display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;
            margin-bottom: 15px;
        }
        .prod-footer { margin-top: auto; display: flex; justify-content: flex-end; }
        .btn-action {
            background: var(--accent); color: var(--primary); border: none;
            padding: 10px 24px; border-radius: var(--radius-btn); font-weight: 800; font-size: 14px; cursor: pointer;
        }
        /* --- 6. å¼¹çª— (Modal) --- */
        .modal-overlay, .cart-overlay, .legal-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.6);
            backdrop-filter: blur(0.5px); display: none; justify-content: center; align-items: flex-end;
            transition: opacity 0.3s;
        }
        .cart-overlay { z-index: 2000; }
        .modal-overlay { z-index: 2100; }
        .legal-overlay { z-index: 2200; }
        
        @media(min-width: 768px) {
            .modal-overlay, .cart-overlay, .legal-overlay { align-items: center; }
            .modal-shell, .cart-shell, .legal-shell { max-width: 480px !important; border-radius: 24px !important; height: 85vh !important; }
            /* Legal shell can be wider */
            .legal-shell { max-width: 720px !important; }
        }
        .modal-shell, .cart-shell, .legal-shell {
            background: var(--white); width: 100%; height: 91.25%;
            border-radius: 24px 24px 0 0; display: flex; flex-direction: column;
            position: relative; overflow: hidden;
            transform: translateY(100%);
            transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        .modal-shell.open, .cart-shell.open, .legal-shell.open { transform: translateY(0); }
        .cart-shell { background: #F5F7FA; }
        .close-btn, .legal-close {
            position: absolute; top: 15px; right: 15px;
            background: rgba(255,255,255,0.9); width: 36px; height: 36px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 20px; cursor: pointer; z-index: 30;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .modal-scroll { flex: 1; overflow-y: auto; overflow-x: hidden; padding-bottom: 20px; }
        .modal-hero-img { width: 100%; height: 280px; object-fit: cover; display: block; }
        .modal-content-box { padding: 24px; }
        .m-title { font-size: 24px; font-weight: 900; margin-bottom: 12px; color: var(--primary); }
        .m-desc { font-size: 15px; color: var(--text-gray); line-height: 1.6; margin-bottom: 30px; }
        .variant-section { border-top: 1px solid var(--border); padding-top: 20px; }
        .v-label { font-size: 13px; font-weight: 800; color: #999; margin-bottom: 15px; display: block; text-transform: uppercase; letter-spacing: 1px; }
        
        .modal-footer {
            padding: 25px 20px 25px 20px; background: var(--white);
            border-top: 0px solid var(--border); z-index: 20;
            display: flex; flex-direction: column; gap: 10px;
        }
        .btn-add-cart {
            width: 100%; background: var(--accent); color: var(--primary); border: none;
            padding: 17px 17px; border-radius: var(--radius-btn); font-size: 17px; font-weight: 900;
            display: flex; justify-content: center; align-items: center; cursor: pointer;
            box-shadow: 0 5px 15px rgba(244, 192, 75, 0.3);
        }
        /* Cart Modal Styles */
        .cart-header {
            padding: 14px 18px; background: white; text-align: center;
            font-weight: 900; font-size: 18px; border-bottom: 1px solid var(--border);
        }
        .cart-list { flex: 1; overflow-y: auto; padding: 16px; background: white;}
        .cart-item {
            background: white; border-radius: 16px; padding: 15px;
            display: flex; gap: 15px; margin-bottom: 20px; margin-top: 14.5px;
            box-shadow: 0 0px 15px 2.5px rgba(16, 41, 64, 0.1);
             cursor: pointer;
        }
        .cart-img { width: 70px; height: 70px; border-radius: 12px; object-fit: cover; }
        .cart-info { flex: 1; display: flex; flex-direction: column; justify-content: center; }
        .c-title { font-weight: 800; font-size: 15px; margin-bottom: 4px; }
        .c-sku { font-size: 13px; color: #888; margin-bottom: 4px; }
        .c-price { font-weight: 800; font-size: 15px; color: var(--primary); }
        .cart-actions {
            display: flex; flex-direction: column; align-items: flex-end; justify-content: center; gap: 8px;
        }
        .mini-qty {
            background: #F3F4F6; border-radius: 8px; padding: 2px 8px;
            font-size: 13px; font-weight: 800; display: flex; align-items: center; gap: 8px;
        }
        .mini-btn { width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; cursor: pointer; }
        .edit-hint { font-size: 11px; color: #AAA; font-weight: 600; text-transform: uppercase; }
        
        /* Sticky Cart */
        .sticky-cart {
            position: fixed; bottom: 25px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 400px; background: var(--primary); color: white;
            padding: 15px 20px; border-radius: 50px;
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 8px 20px rgba(16, 41, 64, 0.3); z-index: 800;
            cursor: pointer; transition: all 0.2s;
        }
        .sticky-cart:active { transform: translateX(-50%) scale(0.96); }
        .badge { background: var(--accent); color: var(--primary); padding: 4px 10px; border-radius: 20px; font-weight: 800; font-size: 14px; margin-right: 10px; }
        .toast {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.85); color: white; padding: 16px 30px;
            border-radius: 30px; z-index: 3000; opacity: 0; pointer-events: none;
            transition: opacity 0.3s; font-weight: 700;
        }
        
        /* Variant Rows */
        .v-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 14px 0; border-bottom: 1px solid var(--border); cursor: default;
        }
        .v-left{ display:flex; flex-direction:column; gap:4px; }
        .v-name{ font-weight: 800; font-size: 16.5px; color: var(--primary); }
        .v-subprice{ font-weight: 800; font-size: 15.5px; color: var(--primary); opacity: 0.85; }
        .v-qty{
            display:flex; align-items:center; gap:10px;
            background:#F3F4F6; border-radius: 14px; padding: 6px 10px;
            font-weight: 900;
        }
        .v-qty-btn{
            width: 28px; height: 28px; border-radius: 12px;
            display:flex; align-items:center; justify-content:center;
            cursor:pointer; user-select:none;
        }
        .v-qty-val{
            min-width: 18px; text-align:center; font-weight: 900;
        }
        
        /* Cart Total Row */
        .cart-total-row{
            padding: 18px 18px 0px 18px;
            background: white;
            border-top: 0px solid var(--border);
            display:flex;
            justify-content:space-between;
            align-items:center;
            font-weight: 900;
            font-size: 17px;
        }
        .modal-scroll{ padding-bottom: 10px; }

        /* ========= [NEW] Footer & Legal Styles ========= */
        .site-footer{
          max-width: 1000px;
          margin: 28px auto 0;
          padding: 30px 20px 24px;
          color: #7b7b7b;
        }
        .footer-links{
          display:flex;
          flex-wrap: wrap;
          gap: 10px;
          justify-content: center;
          margin-bottom: 10px;
        }
        .footer-link{
          border: 1px solid #E5E7EB;
          background: #fff;
          color: var(--primary);
          padding: 10px 14px;
          border-radius: 999px;
          font-weight: 900;
          font-size: 12px;
          cursor:pointer;
        }
        .footer-note{
          text-align:center;
          font-size: 12px;
          line-height: 1.5;
          margin-top: 25px;
        }
        /* Legal Modal Internals */
       .legal-header{
  padding: 18px 20px 14px;
  border-bottom: 1px solid var(--border);
  background: rgba(255,255,255,0.95);
  backdrop-filter: blur(10px);
  position: sticky;
  top: 0;
  z-index: 5;

  /* ğŸ‘‡ æ ¸å¿ƒæ”¹åŠ¨ */
  display: flex;
  flex-direction: column;   /* çºµå‘æ’åˆ— */
  align-items: center;      /* æ•´ä½“å±…ä¸­ */
  gap: 12px;                /* æ ‡é¢˜å’ŒæŒ‰é’®é—´è· */
}

       .legal-title{
  font-size: 18px;
  font-weight: 900;
  margin: 0;
  color: var(--primary);
  text-align: center;   /* ğŸ‘ˆ æ ‡é¢˜æ–‡å­—å±…ä¸­ */
}

       .legal-tabs{
  display: flex;
  gap: 8px;
  flex-wrap: wrap;          /* å°å±è‡ªåŠ¨æ¢è¡Œ */
  justify-content: center;  /* ğŸ‘ˆ æ°´å¹³å±…ä¸­ */
}

        .legal-tab{
          border: 1px solid #E5E7EB;
          background: #fff;
          padding: 8px 10px;
          border-radius: 999px;
          font-weight: 900;
          font-size: 12px;
          cursor:pointer;
          color: var(--primary);
          opacity: 0.75;
        }
        .legal-tab.active{
          background: var(--accent);
          opacity: 1;
        }
        .legal-body{
          flex:1;
          overflow-y:auto;
          padding: 18px 20px 24px;
        }
        .legal-section{
          display:none;
          animation: fadeIn 0.15s ease-in;
        }
        .legal-section.active{ display:block; }
        .legal-h2{
          font-size: 16px;
          font-weight: 900;
          margin: 16px 0 8px;
          color: var(--primary);
        }
        .legal-p{
          margin: 0 0 10px;
          color: #4b5563;
          font-size: 13px;
          line-height: 1.6;
        }
        .legal-list{
          margin: 0 0 14px 18px;
          color: #4b5563;
          font-size: 13px;
          line-height: 1.6;
        }
        .legal-kv{
          background: #F5F7FA;
          border: 1px solid #EAEAEA;
          border-radius: 16px;
          padding: 12px 14px;
          margin: 10px 0 14px;
          font-size: 13px;
          color: #374151;
          line-height: 1.6;
        }
        .legal-kv b{ color: var(--primary); }
        .legal-muted{
          color:#9ca3af;
          font-size: 12px;
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Animation & Skeleton */
        .reveal-card{
            opacity: 0; translate: 0 30px; transition: opacity .55s ease, translate .55s ease;
            will-change: opacity, translate;
        }
        .reveal-card.is-visible{ opacity: 1; translate: 0 0; }
        @supports not (translate: 0 0){
            .reveal-card{ transform: translateY(30px); transition: opacity .55s ease, transform .55s ease; }
            .reveal-card.is-visible{ transform: translateY(0); }
        }
        @media (prefers-reduced-motion: reduce){
            .reveal-card{ opacity: 1 !important; translate: 0 0 !important; transform: none !important; transition: none !important; }
        }
        .skel-img{ opacity: 0; transform: none; background: #f2f2f2; transition: opacity .5s ease; display: block; }
        .cat-img.skel-img, .prod-img.skel-img{ transition: opacity .5s ease, transform .5s ease; }
        .skel-img.is-loading{
            background-image: linear-gradient(90deg, rgba(242,242,242,1) 0%, rgba(255,255,255,1) 20%, rgba(242,242,242,1) 40%, rgba(242,242,242,1) 100%);
            background-size: 400% 100%;
            animation: sk-shimmer 1.2s linear infinite;
        }
        @keyframes sk-shimmer{ 0%{ background-position: 100% 0; } 100%{ background-position: -100% 0; } }
        .skel-img.is-loaded{ opacity: 1; transform: none; background: none; animation: none; }
        .skel-img.is-error{ opacity: 1; transform: scale(1); background: #f2f2f2; animation: none; }
        .skel-img.is-loaded.is-loading{ animation: none; background: none; }
        @supports (scale: 1){ .cat-card:active { transform: none; scale: 0.98; } }
</style>
</head>
<body>
<!-- Header -->
<div class="smart-header">
	<div class="header-left">
		<img src="https://i.ibb.co/sJtMRwDB/IMG-20251219-091347.png" class="logo-img" alt="Neco's">
	</div>
	<div class="lang-switch">
		<button class="lang-btn" onclick="setLang('en', true)">EN</button>
		<button class="lang-btn" onclick="setLang('pt', true)">PT</button>
		<button class="lang-btn" onclick="setLang('cn', true)">CN</button>
	</div>
</div>

<div class="container">
	<!-- Permanent Search Bar -->
	<div class="search-hero">
		<div class="back-nav">
			<button class="btn-back" onclick="goBack()">
			<span class="back-icon"></span>
			<span id="txt-back">Home</span>
			</button>
		</div>
		<div class="search-hero-inner">
			<span class="search-icon"></span>
			<input type="search" id="search-input" class="search-input" placeholder="Search..." enterkeyhint="search" oninput="handleSearch()" onkeydown="onSearchKeyDown(event)">
			<span class="search-clear" id="search-clear" onclick="clearSearch()">âœ•</span>
		</div>
	</div>
    
	<!-- 1. é¦–é¡µ (Home) -->
	<div id="view-home" class="view-section active">
		<div class="category-grid" id="category-grid">
		</div>
	</div>
    
	<!-- 2. åˆ—è¡¨é¡µ (Category / Search Results) -->
	<div id="view-category" class="view-section">
		<div id="category-content">
		</div>
	</div>

    <!-- [NEW] Footer (Legal) -->
    <footer class="site-footer">
        <div class="footer-links">
          <button id="footer-btn-legal" class="footer-link" onclick="openLegalModal('legal')">Legal</button>
          <button id="footer-btn-terms" class="footer-link" onclick="openLegalModal('terms')">Terms</button>
          <button id="footer-btn-returns" class="footer-link" onclick="openLegalModal('returns')">Returns</button>
          <button id="footer-btn-privacy" class="footer-link" onclick="openLegalModal('privacy')">Privacy</button>
          <button id="footer-btn-disputes" class="footer-link" onclick="openLegalModal('disputes')">Disputes</button>
        </div>
        <div class="footer-note">
          <span id="footer-note-text">Â© <span id="footer-year"></span> Neco's Custom Cake Â· All rights reserved.</span>
        </div>
    </footer>
</div>

<!-- 3. äº§å“è¯¦æƒ…å¼¹çª— (Product Modal) -->
<div class="modal-overlay" id="product-modal" onclick="closeModal(event)">
	<div class="modal-shell" id="modal-shell" onclick="event.stopPropagation()">
		<div class="close-btn" onclick="closeModalDirect()">âœ•</div>
		<div class="modal-scroll">
			<img src="" id="m-img" class="modal-hero-img">
			<div class="modal-content-box">
				<div class="m-title" id="m-title">Title</div>
				<div class="m-desc" id="m-desc">Desc</div>
				<div class="variant-section">
					<label class="v-label" id="txt-select-size">SELECT SIZE</label>
					<div id="variant-list"></div>
				</div>
			</div>
		</div>
		<div class="modal-footer">
			<button class="btn-add-cart" onclick="confirmAddToCart()">
			<span id="txt-add-btn">Add 0 â‚¬0.00</span>
			</button>
		</div>
	</div>
</div>

<!-- 4. è´­ç‰©è½¦å¼¹çª— (Cart Modal) -->
<div class="cart-overlay" id="cart-modal" onclick="closeCart(event)">
	<div class="cart-shell" id="cart-shell" onclick="event.stopPropagation()">
		<div class="cart-header">
			<span id="txt-your-order">Your Order</span>
			<div style="position:absolute; right:20px; top:20px; cursor:pointer;" onclick="closeCartDirect()">âœ•</div>
		</div>
		<div class="cart-list" id="cart-list"></div>
		<div class="cart-total-row">
			<span id="txt-total">Total</span>
			<span id="cart-modal-total">â‚¬ 0.00</span>
		</div>
		<div class="modal-footer">
			<button class="btn-add-cart" onclick="closeCartDirect()">
			<span style="width:100%; text-align:center;" id="txt-confirm">Confirm</span>
			</button>
		</div>
	</div>
</div>

<!-- [NEW] 5. Legal Modal -->
<div id="legal-modal" class="legal-overlay" onclick="closeLegalByOverlay(event)">
  <div id="legal-shell" class="legal-shell">
    <div class="legal-close" onclick="closeLegalDirect()">Ã—</div>

    <div class="legal-header">
      <h3 id="legal-title" class="legal-title">Legal</h3>
      <div class="legal-tabs">
        <button class="legal-tab" data-tab="legal" onclick="switchLegalTab('legal')">Legal</button>
        <button class="legal-tab" data-tab="terms" onclick="switchLegalTab('terms')">Terms</button>
        <button class="legal-tab" data-tab="returns" onclick="switchLegalTab('returns')">Returns</button>
        <button class="legal-tab" data-tab="privacy" onclick="switchLegalTab('privacy')">Privacy</button>
        <button class="legal-tab" data-tab="disputes" onclick="switchLegalTab('disputes')">Disputes</button>
      </div>
    </div>

    <div class="legal-body">
      <!-- Legal / IdentificaÃ§Ã£o -->
      <section id="legal-section-legal" class="legal-section">
        <div class="legal-kv" id="legal-kv-ident"></div>

        <h4 class="legal-h2" id="legal-h2-scope">Scope</h4>
        <p class="legal-p" id="legal-p-scope"></p>

        <h4 class="legal-h2" id="legal-h2-contacts">Contacts</h4>
        <p class="legal-p" id="legal-p-contacts"></p>
      </section>

      <!-- Terms -->
      <section id="legal-section-terms" class="legal-section">
        <h4 class="legal-h2" id="terms-h2-1">Terms & Conditions of Purchase</h4>
        <p class="legal-p" id="terms-p-1"></p>

        <h4 class="legal-h2" id="terms-h2-2">Orders & Payment</h4>
        <ul class="legal-list" id="terms-list-2"></ul>

        <h4 class="legal-h2" id="terms-h2-3">Prices</h4>
        <p class="legal-p" id="terms-p-3"></p>
      </section>

      <!-- Returns -->
      <section id="legal-section-returns" class="legal-section">
        <h4 class="legal-h2" id="returns-h2-1">Delivery / Pickup</h4>
        <ul class="legal-list" id="returns-list-1"></ul>

        <h4 class="legal-h2" id="returns-h2-2">Exchanges & Returns</h4>
        <ul class="legal-list" id="returns-list-2"></ul>

        <p class="legal-p legal-muted" id="returns-muted"></p>
      </section>

      <!-- Privacy -->
      <section id="legal-section-privacy" class="legal-section">
        <h4 class="legal-h2" id="privacy-h2-1">Data Protection (RGPD/GDPR)</h4>
        <p class="legal-p" id="privacy-p-1"></p>

        <h4 class="legal-h2" id="privacy-h2-2">What data we collect</h4>
        <ul class="legal-list" id="privacy-list-2"></ul>

        <h4 class="legal-h2" id="privacy-h2-3">Your rights</h4>
        <ul class="legal-list" id="privacy-list-3"></ul>

        <h4 class="legal-h2" id="privacy-h2-4">Cookies</h4>
        <p class="legal-p" id="privacy-p-4"></p>
      </section>

      <!-- Disputes -->
      <section id="legal-section-disputes" class="legal-section">
        <h4 class="legal-h2" id="disputes-h2-1">Alternative Dispute Resolution</h4>
        <p class="legal-p" id="disputes-p-1"></p>

        <div class="legal-kv" id="legal-kv-adr"></div>

        <h4 class="legal-h2" id="disputes-h2-2">Online Dispute Resolution (ODR)</h4>
        <p class="legal-p" id="disputes-p-2"></p>
      </section>
    </div>
  </div>
</div>

<!-- 6. åº•éƒ¨æ‚¬æµ®æ¡ (Sticky Cart) -->
<div class="sticky-cart" id="sticky-cart" onclick="openCartModal()">
	<div style="display:flex; align-items:center;">
		<span class="badge" id="cart-count">0</span>
		<span id="sticky-cart-label" style="font-weight:700;">View Order</span>
	</div>
	<div style="font-weight:800; font-size:18px;" id="cart-bar-total">
		â‚¬ 0.00
	</div>
</div>
<div id="toast" class="toast">
	Update Success!
</div>

<script>
        // ==========================================
        // 0. Love é£æ ¼åŠ¨æ•ˆ
        // ==========================================
        const __fx = { seenCards: new Set(), loadedSrc: new Set(), revealIO: null };
        function __ensureRevealIO(){
          if(__fx.revealIO) return __fx.revealIO;
          __fx.revealIO = new IntersectionObserver((entries) => {
            entries.forEach((e) => {
              if(!e.isIntersecting) return;
              const el = e.target;
              el.classList.add('is-visible');
              const key = el.dataset.revealKey || '';
              if(key) __fx.seenCards.add(key);
              __fx.revealIO.unobserve(el);
            });
          }, { threshold: 0.15 });
          return __fx.revealIO;
        }
        function __normUrl(u){ return (u || '').trim(); }
        function __isImgLoadedByUrl(url){ const u = __normUrl(url); return u && __fx.loadedSrc.has(u); }
        function __imgClass(url, base){
          const loaded = __isImgLoadedByUrl(url);
          return `${base} skel-img js-skel-img ${loaded ? 'is-loaded' : 'is-loading'}`;
        }
        function __imgDataAttrs(url){ const loaded = __isImgLoadedByUrl(url); return loaded ? `data-fx-init="1" data-fx-loaded="1"` : ``; }
        function __cardClass(key, base){
          const seen = key && __fx.seenCards.has(key);
          return `${base} reveal-card js-reveal ${seen ? 'is-visible' : ''}`;
        }
        function __markImgLoaded(img){
          if(!img || img.dataset.fxLoaded === '1') return;
          img.dataset.fxLoaded = '1'; img.classList.remove('is-loading'); img.classList.add('is-loaded');
          const srcKey = __normUrl(img.currentSrc || img.src);
          if(srcKey) __fx.loadedSrc.add(srcKey);
        }
        function __markImgError(img){ if(!img) return; img.classList.remove('is-loading'); img.classList.add('is-error'); }
        function __initReveal(root){
          const io = __ensureRevealIO();
          const cards = (root || document).querySelectorAll('.js-reveal');
          cards.forEach((card) => {
            const key = card.dataset.revealKey || '';
            if(key && card.classList.contains('is-visible')){ __fx.seenCards.add(key); return; }
            if(key && __fx.seenCards.has(key)){ card.classList.add('is-visible'); return; }
            if(!card.classList.contains('is-visible')){ io.observe(card); }
          });
        }
        function __initImages(root){
          const imgs = (root || document).querySelectorAll('img.js-skel-img');
          imgs.forEach((img) => {
            const srcKey = __normUrl(img.currentSrc || img.src);
            if(img.dataset.fxLoaded === '1' || img.classList.contains('is-loaded')){
              if(srcKey) __fx.loadedSrc.add(srcKey); img.dataset.fxInit = '1'; return;
            }
            if(img.dataset.fxInit === '1') return;
            img.dataset.fxInit = '1';
            try { img.decoding = 'async'; } catch(e){}
            if(srcKey && __fx.loadedSrc.has(srcKey)){ __markImgLoaded(img); return; }
            img.classList.add('skel-img'); img.classList.add('is-loading');
            const done = () => { const p = (img.decode ? img.decode() : Promise.resolve()); Promise.resolve(p).catch(() => {}).then(() => __markImgLoaded(img)); };
            const fail = () => __markImgError(img);
            if(img.complete && img.naturalWidth > 0){ done(); return; }
            img.addEventListener('load', done, { once: true });
            img.addEventListener('error', fail, { once: true });
          });
        }
        function initCardFX(root){ __initReveal(root); __initImages(root); }

        // ==========================================
        // 1. æ•°æ®ä¸­å¿ƒ & æ³•å¾‹ä¿¡æ¯
        // ==========================================
        const LEGAL_INFO = {
          ownerName: "Neco's Custom Cake",
          address: "Rua Silva Carvalho 233, Lisboa, Portugal",
          taxId: "288328361",
          email: "Lin968668171@email.com",
          phone: "+351 930523010",
          businessHours: "Monâ€“Sat 11:00â€“19:00",
          deliveryArea: "Lisbon area",
          deliveryTime: "24â€“48h",
          deliveryFee: "From 2â‚¬",
          arbitrationEntity: "Centro de Arbitragem de Conflitos de Consumo de Lisboa (CACCL)",
          arbitrationWebsite: "https://www.centroarbitragemlisboa.pt",
          odrWebsite: "https://ec.europa.eu/consumers/odr",
        };

          const db = {
          categories: [
              { id: "classic", img: "https://dyj6gt4964deb.cloudfront.net/images/crop-5a2f691a-f7d5-4d33-b3be-b84ecea1c831.jpeg",
                title: { cn: "æ°¸è¿œçš„ç»å…¸", en: "Eternal Classic", pt: "ClÃ¡ssico Eterno" },
                desc: { cn: "é»‘æ£®æ— / ææ‹‰ç±³è‹ / çº¢ä¸ç»’", en: "Black Forest / Tiramisu / Red Velvet", pt: "Floresta Negra / Tiramisu" } },
              { id: "layer", img: "https://dyj6gt4964deb.cloudfront.net/images/crop-0038becb-7292-4eea-93f7-9fa986281d21.jpeg",
                title: { cn: "æ‹›ç‰Œåƒå±‚è›‹ç³•", en: "Signature Layer Cake", pt: "Bolo de Mil Camadas" },
                desc: { cn: "æ‰‹å·¥åˆ¶ä½œï¼Œå±‚å±‚ç¾å‘³", en: "Handmade crepe layers", pt: "Camadas de crepe artesanais" } },
              { id: "naked", img: "https://dyj6gt4964deb.cloudfront.net/images/crop-11f1f013-ffc3-4c14-a39e-af3edc99dab8.jpeg",
                title: { cn: "åŸç”Ÿæ€è£¸è›‹ç³•", en: "Naked Fruit Cake", pt: "Bolo Nu" },
                desc: { cn: "æ–°é²œæ°´æœæ­é…é¦™è‰æˆšé£", en: "Fresh fruits with vanilla chiffon", pt: "Frutas frescas com chiffon" } },
              { id: "cheese", img: "https://dyj6gt4964deb.cloudfront.net/images/crop-e4e9d0e4-c631-4a71-bd6a-52caa7a42fd2.jpeg",
                title: { cn: "èŠå£«ä¸æ…•æ–¯", en: "Cheesecake & Mousse", pt: "Bolo de queijo e mousse" },
                desc: { cn: "å¤©ç„¶é£Ÿæï¼Œæµ“éƒå£æ„Ÿ", en: "Natural ingredients", pt: "Ingredientes naturais" } },
              { id: "korean", img: "https://dyj6gt4964deb.cloudfront.net/images/crop-153de66b-9952-45d1-9c9d-09d9b1015029.jpeg",
                title: { cn: "éŸ©å¼å¥¶æ²¹è°ƒå‘³", en: "Korean Style Cream", pt: "Estilo Coreano" },
                desc: { cn: "æ¸…æ–°é£æ ¼ï¼Œç‹¬ç‰¹è°ƒå‘³", en: "Fresh style, flavored cream", pt: "Estilo fresco" } },
              { id: "custom", img: "https://dyj6gt4964deb.cloudfront.net/images/crop-0a61f906-d8d7-45b4-b0c2-c240d5b14e80.jpeg",
                title: { cn: "é€ å‹å®šåˆ¶è›‹ç³•", en: "Custom Design Cake", pt: "Bolo Personalizado" },
                desc: { cn: "æœ‰è¶£å¤–è¡¨ï¼Œå¥½åƒå¥½ç©", en: "Fun & Delicious", pt: "Divertido e delicioso" } }
          ],
          items: {
              "classic": [
                  { id:"c1", img:"https://dyj6gt4964deb.cloudfront.net/images/crop-b267cf6d-fb4d-4d57-9351-8c69c59c54b2.jpeg",
                    title:{ cn:"çº¢ä¸ç»’ä¹³é…ªè›‹ç³•", en:"Red Velvet Cheesecake", pt:"Cheesecake de Veludo Vermelho" },
                    desc:{
                      en:"1. Appearance: The bright red cake layer and the white cheese layer form a sharp contrast, which is very visually attractive and especially suitable for festivals and celebrations.\n2. Taste: Red velvet cake is soft and moist, and paired with the rich cheese layer, it has a delicate taste, sweet but not greasy.\n3. Flavor: Red velvet cake usually has a hint of cocoa aroma, and paired with the slightly sour cheese, the overall taste is richer.",
                      pt:"1. AparÃªncia: As camadas de bolo vermelho vivo contrastam nitidamente com as camadas de cream cheese branco, criando um efeito visual muito atraente, especialmente adequado para feriados e celebraÃ§Ãµes.\n2. Textura: O bolo de veludo vermelho Ã© macio e Ãºmido, combinado com as camadas ricas de cream cheese, resultando em uma textura delicada que Ã© doce, mas nÃ£o excessivamente.\n3. Sabor: O bolo de veludo vermelho geralmente tem um leve aroma de cacau, complementado pela leve acidez do cream cheese, tornando o sabor geral mais complexo e agradÃ¡vel.",
                      cn:"1. å¤–è§‚ï¼š é²œè‰³çš„çº¢è‰²è›‹ç³•å±‚å’Œç™½è‰²ä¹³é…ªå±‚å½¢æˆé²œæ˜å¯¹æ¯”ï¼Œè§†è§‰æ•ˆæœéå¸¸å¸å¼•äººï¼Œç‰¹åˆ«é€‚åˆèŠ‚æ—¥å’Œåº†å…¸åœºåˆã€‚\n2. å£æ„Ÿï¼š çº¢ä¸ç»’è›‹ç³•æŸ”è½¯æ¹¿æ¶¦ï¼Œæ­é…æµ“éƒçš„ä¹³é…ªå±‚ï¼Œå£æ„Ÿç»†è…»ï¼Œç”œè€Œä¸è…»ã€‚\n3. é£å‘³ï¼š çº¢ä¸ç»’è›‹ç³•é€šå¸¸å¸¦æœ‰ä¸€ä¸å¯å¯çš„é¦™æ°”ï¼Œæ­é…ä¹³é…ªçš„å¾®é…¸ï¼Œä½¿æ•´ä½“å£å‘³æ›´åŠ ä¸°å¯Œã€‚"
                    },
                    variants:[
                      { id:"v1", names:{ cn:"6è‹±å¯¸", en:"6 inches", pt:"6 polegadas" }, price:42 },
                      { id:"v2", names:{ cn:"8è‹±å¯¸", en:"8 inches", pt:"8 polegadas" }, price:58 }
                    ]
                  },
                  { id:"c2", img:"https://dyj6gt4964deb.cloudfront.net/images/crop-25ad3750-4ed7-4c4f-a2cc-2d99925374a6.jpeg",
                    title:{ en:"Milk sauce black forest cake", cn:"å¥¶é…±é»‘æ£®æ—è›‹ç³•", pt:"Bolo floresta negra com molho de leite" },
                    desc:{
                      en:"A very rich chocolate sponge cake, with white chocolate cream, dark chocolate cream, and dark rum-stained black cherries in the middle layer. The improved Chantilly cream has a rich milky aroma. It is a classic handmade cake boutique with a blue ribbon",
                      cn:"éå¸¸æµ“éƒçš„å·§å…‹åŠ›æµ·ç»µè›‹ç³•ï¼Œå¤¹å±‚åŒ…å«ç™½å·§å¥¶æ²¹ã€é»‘å·§å¥¶æ²¹ï¼Œä»¥åŠé»‘æœ—å§†é…’æ¸é»‘æ¨±æ¡ƒï¼Œæ”¹è‰¯çš„é¦™ç¼‡å¥¶æ²¹å¥¶é¦™æµ“éƒï¼Œæ˜¯ä¸€æ¬¾è“å¸¦ç»å…¸æ‰‹å·¥è›‹ç³•ç²¾å“",
                      pt:"Um pÃ£o de lÃ³ de chocolate muito rico com camadas de creme de chocolate branco, doce de leite de chocolate negro e cerejas pretas embebidas em rum escuro."
                    },
                    variants:[
                      { id:"v1", names:{ en:"6 inches", cn:"6å¯¸", pt:"6 polegadas" }, price:40 },
                      { id:"v2", names:{ en:"8 inches", cn:"8å¯¸", pt:"8 polegadas" }, price:55 }
                    ]
                  },
                  { id:"c3", img:"https://dyj6gt4964deb.cloudfront.net/images/crop-6f9816fc-5d8f-436d-a97c-baea35005112.jpeg",
                    title:{ pt:"Tiramisu ClÃ¡ssico", cn:"ç»å…¸ææ‹‰ç±³è‹", en:"Classic Tiramisu" },
                    desc:{
                      pt:"Um bolo tiramisu italiano muito clÃ¡ssico, queijo mascarpone, bolachas, cafÃ© expresso lÃ­quido, feito Ã  mÃ£o com ingredientes frescos.",
                      cn:"éå¸¸ç»å…¸çš„æ„å¼ææ‹‰ç±³è‹è›‹ç³•ï¼Œé©¬æ–¯å¡å½­èŠå£«ã€æ‰‹æŒ‡é¥¼å¹²ã€æ„å¼æµ“ç¼©å’–å•¡æ¶²ï¼Œæ–°é²œé£Ÿææ‰‹å·¥åˆ¶ä½œï¼Œè›‹ç³•ä¸Šçš„æ•´ä½“è£…é¥°ç»è¿‡æˆ‘ä»¬çš„è›‹ç³•å¸ˆçš„åˆ›ä½œï¼Œæ›´æ˜¾å¾—å”¯ç¾ç²¾è‡´",
                      en:"Very classic Italian tiramisu cake, mascarpone cheese, ladyfingers, espresso liquid, handmade with fresh ingredients, the overall decoration on the cake is created by our baker, making it more beautiful and exquisite"
                    },
                    variants:[
                      { id:"v1", names:{ pt:"6 polegadas", cn:"6å¯¸", en:"6 inches" }, price:38 },
                      { id:"v2", names:{ pt:"8 polegadas", cn:"8å¯¸", en:"8 inches" }, price:49 }
                    ]
                  }
              ],
              "layer": [
                  { id:"l1", img:"https://dyj6gt4964deb.cloudfront.net/images/38db952a-2ebb-4af1-b733-a223cede14f3.jpeg",
                    title:{ cn:"å·§å…‹åŠ›åƒå±‚è›‹ç³•", en:"Chocolate Melaleuca Cake", pt:"Bolo De Melaleuca De Chocolate" },
                    desc:{
                      cn:"æµ“éƒçš„å·§å…‹åŠ›å¯ä¸½é¥¼ï¼Œå¤¹å±‚ä¸ºå·§å…‹åŠ›å¥¶æ²¹ï¼Œå…¶ä¸­è¿˜æœ‰ä¸€å±‚å·§å…‹åŠ›æ…•æ–¯ï¼Œå¦‚æœä½ çƒ­çˆ±æµ“éƒçš„å·§å…‹åŠ›é£å‘³ï¼Œä¸€å®šä¸èƒ½é”™è¿‡",
                      en:"Rich chocolate crepe, sandwiched with chocolate cream and a layer of chocolate mousse. If you love rich chocolate flavor, you must not miss it.",
                      pt:"Rico crepe de chocolate, prensado com creme de chocolate e uma camada de mousse de chocolate."
                    },
                    variants:[
                      { id:"v1", names:{ cn:"4è‹±å¯¸", en:"4 inches", pt:"4 polegadas" }, price:23 },
                      { id:"v2", names:{ cn:"6è‹±å¯¸", en:"6 inches", pt:"6 polegadas" }, price:38 },
                      { id:"v3", names:{ cn:"8è‹±å¯¸", en:"8 inches", pt:"8 polegadas" }, price:48 }
                    ]
                  },
                  { id:"l2", img:"https://dyj6gt4964deb.cloudfront.net/images/crop-c168cd8a-0bc8-49bc-928e-0ed3239e0ac2.jpeg",
                    title:{ cn:"è‰è“åƒå±‚è›‹ç³•", en:"Strawberry Melaleuca Cake", pt:"Bolo De Melaleuca De Morango" },
                    desc:{ cn:"çº¢ä¸ç»’å£å‘³çš„å¯ä¸½é¥¼çš®ï¼Œå¤¹å±‚ä¸ºæ–°é²œè‰è“ç†¬åˆ¶æœé…±èåˆç™½å·§å…‹åŠ›å¥¶æ²¹ï¼Œæ–°é²œè‰è“ç‚¹ç¼€åœ¨è›‹ç³•ä¸Šé¢ï¼Œå£å‘³æ¸…æ–°ç‹¬ç‰¹",
                          en:"The red velvet crepe crust is sandwiched with fresh strawberry jam blended with white chocolate cream. Fresh strawberries are dotted on the cake, giving it a fresh and unique taste.",
                          pt:"Crosta de crepe com sabor a veludo vermelho, prensada com geleia de morango fresca e creme de chocolate branco, morangos frescos estÃ£o espalhados por cima do bolo e o sabor Ã© fresco e Ãºnico" },
                    variants:[
                      { id:"v1", names:{ cn:"4è‹±å¯¸", en:"4 inches", pt:"4 polegadas" }, price:23 },
                      { id:"v2", names:{ cn:"6è‹±å¯¸", en:"6 inches", pt:"6 polegadas" }, price:38 },
                      { id:"v3", names:{ cn:"8è‹±å¯¸", en:"8 inches", pt:"8 polegadas" }, price:48 }
                    ] },
                  { id:"l3", img:"https://dyj6gt4964deb.cloudfront.net/images/crop-3854a4fe-b655-42f2-8521-19638e9e5d9c.jpeg",
                    title:{ cn:"æŠ¹èŒ¶åƒå±‚è›‹ç³•", en:"Matcha Melaleuca Cake", pt:"Bolo Matcha Melaleuca" },
                    desc:{ cn:"ç‰¹çº§æ—¥æœ¬å®‡æ²»æŠ¹èŒ¶ç²‰ï¼Œå¤¹å±‚ä¸ºæŠ¹èŒ¶å£å‘³çš„å·§å…‹åŠ›å¥¶æ²¹ï¼Œå£æ„Ÿç»†è…»ï¼Œå±‚æ¬¡ä¸°å¯Œ",
                          en:"Premium Japanese Uji Matcha powder, with a layer of Matcha-flavored chocolate cream, for a delicate taste and rich layers",
                          pt:"PÃ³ Uji matcha japonÃªs de qualidade especial, prensado com creme de chocolate com sabor a matcha, com um sabor delicado e camadas ricas" },
                    variants:[
                      { id:"v1", names:{ cn:"4è‹±å¯¸", en:"4 inches", pt:"4 polegadas" }, price:25 },
                      { id:"v2", names:{ cn:"6è‹±å¯¸", en:"6 inches", pt:"6 polegadas" }, price:40 },
                      { id:"v3", names:{ cn:"8è‹±å¯¸", en:"8 inches", pt:"8 polegadas" }, price:55 }
                    ] },
                  { id:"l4", img:"https://dyj6gt4964deb.cloudfront.net/images/crop-2d13e6b9-ce8b-4516-a663-f9c90e1935ee.jpeg",
                    title:{ cn:"èŠ’æœåƒå±‚è›‹ç³•", en:"Mango Melaleuca Cake", pt:"Bolo Melaleuca De Manga" },
                    desc:{ cn:"é¦™è‰å£å‘³çš„å¯ä¸½é¥¼ï¼Œå¤¹å±‚åŒ…å«èŠ’æœå¸ƒä¸å’Œç™½å·§å¥¶æ²¹ï¼Œç‚¹ç¼€èŠ’æœæœè‚‰ï¼Œæ¸…æ–°çˆ½å£çš„å¤å¤©çš„æ„Ÿè§‰",
                          en:"Vanilla-flavored crepes with mango pudding and white chocolate cream in between, dotted with mango pulp, giving you a refreshing summer feel",
                          pt:"Crepe com sabor a baunilha, prensado com pudim de manga e creme de chocolate branco, embelezado com polpa de manga, refrescante sensaÃ§Ã£o de verÃ£o" },
                    variants:[
                      { id:"v1", names:{ cn:"4è‹±å¯¸", en:"4 inches", pt:"4 polegadas" }, price:23 },
                      { id:"v2", names:{ cn:"6è‹±å¯¸", en:"6 inches", pt:"6 polegadas" }, price:36 },
                      { id:"v3", names:{ cn:"8è‹±å¯¸", en:"8 inches", pt:"8 polegadas" }, price:48 }
                    ] }
              ],
              "naked": [
                { id:"n1", img:"https://dyj6gt4964deb.cloudfront.net/images/crop-e378d704-2d39-4765-8f46-14c5ece07b85.jpeg",
                  title:{ cn:"é¦™è‰å¥¶æ²¹æ°´æœè£¸è›‹ç³•", en:"Vanilla Cream Fruit Naked Cake", pt:"Bolo Nu De Fruta Com Creme De Baunilha" },
                  desc:{ cn:"é¦™è‰æˆšé£è›‹ç³•ç»“åˆç™½å·§å…‹åŠ›å¥¶æ²¹ï¼Œèåˆè‰è“ã€è“è“ã€èŠ’æœç­‰æ–°é²œæ°´æœã€‚å£æ„ŸæŸ”è½¯ï¼Œæ¸…çˆ½ï¼Œå±‚æ¬¡ä¸°å¯Œï¼Œéå¸¸å¥åº·ç¾å‘³ã€‚",
                        en:"Vanilla chiffon cake is combined with white chocolate cream and fresh fruits such as strawberries, blueberries, and mangoes. It has a soft, refreshing texture, rich layers, and is very healthy and delicious.",
                        pt:"O bolo chiffon de baunilha combina creme de chocolate branco com morangos, mirtilos, manga e outras frutas frescas. O sabor Ã© suave, refrescante, rico em camadas, muito saudÃ¡vel e delicioso." },
                  variants:[
                    { id:"v1", names:{ cn:"6è‹±å¯¸", en:"6 inches", pt:"6 polegadas" }, price:32 },
                    { id:"v2", names:{ cn:"8è‹±å¯¸", en:"8 inches", pt:"8 polegadas" }, price:42 }
                  ] },
                { id:"n2", img:"https://dyj6gt4964deb.cloudfront.net/images/crop-414cc726-60e9-4bb5-a145-776fdbb67e13.jpeg",
                  title:{ cn:"æŠ¹èŒ¶é’æè£¸è›‹ç³•", en:"Matcha Grape Naked Cake", pt:"Bolo nu de chÃ¡ verde Matcha" },
                  desc:{ cn:"æŠ¹èŒ¶é’æè£¸è›‹ç³•æ˜¯ä¸€æ¬¾éå¸¸å…¸å‹çš„æ—¥å¼è›‹ç³•ã€‚ç»“åˆäº†æ¸…æ–°æŠ¹èŒ¶å¥¶æ²¹é£å‘³å’Œçˆ½å£é’æã€‚ç®€çº¦è‡ªç„¶ï¼Œå£æ„Ÿä¸°å¯Œå¤šå±‚æ¬¡ï¼Œæ¸…æ–°èŒ¶é¦™å’Œæ°´æœèåˆåï¼Œå……æ»¡è´¨æ„Ÿå’Œå“ä½ã€‚",
                        en:"Matcha Grape Naked Cake is a very typical Japanese cake. It combines the fresh flavor of matcha cream and refreshing grapes. It is simple and natural, with a rich and multi-layered taste. The fusion of fresh tea fragrance and fruit is full of texture and taste.",
                        pt:"O bolo nu de chÃ¡ verde Matcha Ã© um bolo japonÃªs muito tÃ­pico. Combinando o sabor refrescante do creme matcha com as refrescantes uvas verdes. Simples e natural, o sabor Ã© rico e multifacetado. O aroma do chÃ¡ fresco e a fruta combinam-se para o tornar cheio de textura e sabor." },
                  variants:[
                    { id:"v1", names:{ cn:"6è‹±å¯¸", en:"6 inches", pt:"6 polegadas" }, price:33 },
                    { id:"v2", names:{ cn:"8è‹±å¯¸", en:"8 inches", pt:"8 polegadas" }, price:45 }
                  ] },
                { id:"n3", img:"https://dyj6gt4964deb.cloudfront.net/images/crop-175c858c-f49c-4209-bfbc-a3ea7bb6a109.jpeg",
                  title:{ cn:"å·§å…‹åŠ›æ°´æœå¥¶æ²¹è£¸è›‹ç³•", en:"Chocolate Fruit Cream Naked Cake", pt:"Bolo Nu De Creme De Frutas De Chocolate" },
                  desc:{ cn:"å·§å…‹åŠ›æ°´æœå¥¶æ²¹è£¸è›‹ç³•æ˜¯ä¸€æ¬¾ç»“åˆäº†å·§å…‹åŠ›çš„æµ“éƒé¦™å‘³ã€å¥¶æ²¹çš„ä¸æ»‘å£æ„Ÿå’Œæ–°é²œæ°´æœæ¸…çˆ½é£å‘³çš„ç¾å‘³è›‹ç³•ã€‚éå¸¸é€‚åˆç”¨äºç”Ÿæ—¥ã€å©šç¤¼ã€èŠ‚æ—¥èšä¼šç­‰å„ç§åº†ç¥æ´»åŠ¨ã€‚",
                        en:"Chocolate Fruit Cream Naked Cake is a delicious cake that combines the rich aroma of chocolate, the smooth taste of cream and the refreshing flavor of fresh fruit. It is very suitable for various celebrations such as birthdays, weddings, holiday parties, etc.",
                        pt:"Chocolate Cream Fruit Naked Cake Ã© um delicioso bolo que combina o rico aroma do chocolate, a textura sedosa do creme e o sabor refrescante da fruta fresca. Perfeito para diversas celebraÃ§Ãµes, como aniversÃ¡rios, casamentos, festas de fim de ano e muito mais." },
                  variants:[
                    { id:"v1", names:{ cn:"6è‹±å¯¸", en:"6 inches", pt:"6 polegadas" }, price:33 },
                    { id:"v2", names:{ cn:"8è‹±å¯¸", en:"8 inches", pt:"8 polegadas" }, price:48 }
                  ] }
              ],
              
            "cheese": [
{ id:"c1", img:"https://dyj6gt4964deb.cloudfront.net/images/28bd1b3b-6ba5-4dd1-a6ad-9556bc81a810.jpeg",
title:{ cn:"çº½çº¦èŠå£«è›‹ç³•", en:"New York Cheesecake", pt:"Cheesecake de Nova Iorque" },
desc:{ cn:"èŠå£«è›‹ç³•ä¸­çš„æ—¶å°šä¹‹ç‹å°±æ˜¯å¥¹äº†ï¼", en:"She is the fashion king of cheesecake!", pt:"Ã‰ a rainha da moda dos cheesecakes!" },
variants:[
{ id:"v1", names:{ cn:"6è‹±å¯¸", en:"6 inches", pt:"6 polegadas" }, price:38 },
{ id:"v2", names:{ cn:"8è‹±å¯¸", en:"8 inches", pt:"8 polegadas" }, price:50 },
{ id:"v3", names:{ cn:"4è‹±å¯¸", en:"4 inches", pt:"4 polegadas" }, price:28 }
] },

{ id:"ch2",
img:"https://dyj6gt4964deb.cloudfront.net/images/crop-6054df78-55f3-4d63-8952-6530bbe00258.jpeg",
title:{
cn:"æŸ æª¬èŠå£«è›‹ç³•",
en:"Lemon Yogurt Mousse",
pt:"Mousse de Iogurte com LimÃ£o"
},
desc:{
cn:"æ–°é²œæŸ æª¬åˆ¶ä½œçš„é…¸å¥¶æ…•æ–¯è›‹ç³•ï¼Œæ‹¥æœ‰éå¸¸æ¸…æ–°çš„æŸ æª¬é¦™ï¼Œé…¸ç”œå£å‘³ï¼Œä½ç³–",
en:"Yogurt mousse cake made with fresh lemon has a very fresh lemon scent, sweet and sour taste, and low sugar",
pt:"Bolo de mousse de iogurte feito com limÃµes frescos, com aroma a limÃ£o muito fresco, sabor agridoce e baixo teor de aÃ§Ãºcar"
},
variants:[
{ id:"v1", names:{ cn:"6å¯¸", en:"6 inches", pt:"6 polegadas" }, price:33 },
{ id:"v2", names:{ cn:"8å¯¸", en:"8 inches", pt:"8 polegadas" }, price:45 }
]
},

{ id:"ch3",
img:"https://dyj6gt4964deb.cloudfront.net/images/crop-74f0a75c-3712-41c9-8447-5749b2f1afbd.jpeg",
title:{
cn:"ç„¦ç³–æ…•æ–¯è›‹ç³•",
en:"Caramel Mousse Cake",
pt:"Bolo Mousse de Caramelo"
},
desc:{
cn:"å¤ªå¥½åƒäº†ï¼",
en:"too delicious!",
pt:"delicioso demais!"
},
variants:[
{ id:"v1", names:{ cn:"6è‹±å¯¸", en:"6 inches", pt:"6 polegadas" }, price:38 },
{ id:"v2", names:{ cn:"8è‹±å¯¸", en:"8 inches", pt:"8 polegadas" }, price:50 }
]
},

{ id:"ch4",
img:"https://dyj6gt4964deb.cloudfront.net/images/crop-bcc1aedb-728f-4895-96be-fb89ee828fb9.jpeg",
title:{
cn:"æŠ¹èŒ¶é…¸å¥¶å£å‘³çš„æ¼«ç”»è›‹ç³•",
en:"Matcha yogurt flavored cartoon cake",
pt:"Bolo manga com sabor a iogurte matcha"
},
desc:{
cn:"æŠ¹èŒ¶èŠå£«ï¼Œç™½å·§é…¸å¥¶ï¼Œè“æŸ‘æ…•æ–¯ä¸‰ç§å£å‘³å±‚æ¬¡ä¸°å¯Œçš„èŠå£«æ…•æ–¯è›‹ç³•ï¼Œæ‹¥æœ‰å®ƒå°±åƒæ‹¥æœ‰äº†è“å¤©ç™½äº‘è‰åœ°çš„å¿«ä¹",
en:"Matcha cheese, white chocolate yogurt, blue mandarin mousse three flavors of rich cheese mousse cake, having it is like having the happiness of blue sky, white clouds and grass",
pt:"Queijo matcha, iogurte branco e mousse de tangerina azul sÃ£o trÃªs sabores de bolo de mousse de queijo com camadas ricas."
},
variants:[
{ id:"v1", names:{ cn:"6è‹±å¯¸", en:"6 inches", pt:"6 polegadas" }, price:38 },
{ id:"v2", names:{ cn:"8è‹±å¯¸", en:"8 inches", pt:"8 polegadas" }, price:50 }
]
}
              ],
                
              "korean": [
{ id:"k1", img:"https://dyj6gt4964deb.cloudfront.net/images/73898ee3-72c2-4f27-81f5-2013d579610c.jpeg",
title:{ cn:"é¦™è•‰å·§å…‹åŠ›å¥¶æ²¹æ°´æœè›‹ç³•", en:"Banana Chocolate Cream Fruit Cake", pt:"Bolo De Fruta Com Creme De Chocolate De Banana" },
desc:{
cn:"å·§å…‹åŠ›å‘³é“çš„æŸ”è½¯æˆšé£è›‹ç³•ï¼Œå¤¹å±‚åŒ…å«å·§å…‹åŠ›å¥¶æ²¹å’Œé¦™è•‰æœæ³¥ï¼Œæ­é…æ–°é²œæ°´æœï¼Œå£å‘³æ¸…çˆ½ä¸ç”œè…»ï¼Œæ˜¯ä¸€æ¬¾æ¸…çˆ½çš„å·§å…‹åŠ›è›‹ç³•",
en:"A soft chiffon cake with chocolate flavor. The interlayer contains chocolate cream and banana puree, paired with fresh fruits. It tastes refreshing and not too sweet. It is a refreshing chocolate cake.",
pt:"Bolo chiffon macio com sabor a chocolate. A sanduÃ­che contÃ©m creme de chocolate e purÃª de banana."
},
variants:[
{ id:"v1", names:{ cn:"6è‹±å¯¸", en:"6 inches", pt:"6 polegadas" }, price:36 },
{ id:"v2", names:{ cn:"8è‹±å¯¸", en:"8 inches", pt:"6 polegadas" }, price:48 }
] },

{ id:"k2", img:"https://dyj6gt4964deb.cloudfront.net/images/crop-b5f9460c-fa6b-43c2-ba0b-4c25da3ab000.jpeg",
title:{ cn:"æ‘©å¡æ›²å¥‡å£å‘³å¥¶æ²¹è›‹ç³•", en:"Mocha Cookies Cream Cake", pt:"Bolo de creme com sabor a bolacha mocha" },
desc:{
cn:"å·§å…‹æˆšé£è½¯è›‹ç³•èƒšï¼Œå’–å•¡å£å‘³å¥¶æ²¹ï¼Œå†…åŠ æ›²å¥‡é¥¼å¹²ï¼ŒæŸ”è½¯åˆæœ‰é¦™è„†çš„å£æ„Ÿ",
en:"Chocolate chiffon soft cake base, coffee flavored cream, and cookies inside, soft and crispy taste",
pt:"Base de bolo macio chiffon de chocolate, creme com sabor a cafÃ©, recheado com bolachas, textura macia e crocante"
},
variants:[
{ id:"v1", names:{ cn:"6è‹±å¯¸", en:"6 inches", pt:"6 polegadas" }, price:36 },
{ id:"v2", names:{ cn:"8è‹±å¯¸", en:"8 inches", pt:"8 polegadas" }, price:48 }
] },

{ id:"k3", img:"https://dyj6gt4964deb.cloudfront.net/images/crop-657be4a4-aad7-43b8-9418-173e475a5273.jpeg",
title:{ cn:"å®‡æ²»æŠ¹èŒ¶çº¢è±†æ–‘æ–“å¥¶æ²¹è›‹ç³•", en:"Uji Matcha Red Bean Cream Cake", pt:"Bolo de creme de feijÃ£o vermelho Uji matcha" },
desc:{
cn:"æ­£å®—å®‡æ²»æŠ¹èŒ¶ç²‰æ‰‹ä½œæˆšé£è½¯èƒšè›‹ç³•ï¼Œæ‹¥æœ‰æ–‘æ–“çº¢è±†èåˆçš„ç™½å·§å¥¶æ²¹ï¼Œæ­é…æ°´æœè£…é¥°ï¼Œæ¸…æ–°çš„èŒ¶é¦™æœé¦™çº¢è±†çš„ç”œï¼Œæ•´ä½“è›‹ç³•è™½ç„¶èŒ¶é¦™æµ“éƒï¼Œå´å¹¶ä¸è‹¦æ¶©ï¼Œæˆ‘ä»¬çš„æŠ¹èŒ¶ææ–™å‡ä¸ºæ—¥æœ¬é¡¶çº§æŠ¹èŒ¶ï¼Œå€¼å¾—å°è¯•ï¼",
en:"The authentic Uji Matcha powder handmade chiffon soft cake has white chocolate cream blended with colorful red beans, decorated with fruits, and has a refreshing tea aroma, fruit aroma and the sweetness of red beans. Although the overall cake has a strong tea aroma, it is not bitter. Our matcha ingredients are all top-grade Japanese matcha, it is worth a try!",
pt:"AutÃªntico bolo de embriÃ£o macio de chiffon feito Ã  mÃ£o em pÃ³ Uji matcha, com creme branco fundido com feijÃ£o vermelho colorido, com decoraÃ§Ã£o de frutas, aroma de chÃ¡ fresco e doÃ§ura de feijÃ£o vermelho frutado. qualidade do JapÃ£o, vale a pena experimentar!"
},
variants:[
{ id:"v1", names:{ cn:"6è‹±å¯¸", en:"6 inches", pt:"6 polegadas" }, price:38 },
{ id:"v2", names:{ cn:"8è‹±å¯¸", en:"8 inches", pt:"8 polegadas" }, price:50 }
] },

{ id:"k4", img:"https://dyj6gt4964deb.cloudfront.net/images/crop-9b832479-e5d6-4fc4-8c7a-3f5e2983b67f.jpeg",
title:{ cn:"æŸ æª¬é¦™ç¼‡è“æœå¥¶æ²¹è›‹ç³•", en:"Lemon Chantilly Berry Cream Cake", pt:"Bolo de Creme de LimÃ£o Chantilly" },
desc:{
cn:"æŸ æª¬å£å‘³æˆšé£è›‹ç³•ï¼Œå¤¹å±‚åŒ…å«è“æœæœè†ï¼Œç™½å·§å¥¶æ²¹ï¼Œæ­é…æ–°é²œæ— èŠ±æœæ°´æœï¼Œè¿™æ˜¯ä¸€æ¬¾é£å‘³æä¸ºå‡ºä¼—çš„åˆ›æ„è›‹ç³•",
en:"Lemon-flavored chiffon cake, with berry paste, white chocolate cream, and fresh figs, is a creative cake with outstanding flavor.",
pt:"Bolo chiffon com sabor a limÃ£o, prensado com pasta de frutos vermelhos, creme de chocolate branco e figo fresco."
},
variants:[
{ id:"v1", names:{ cn:"6è‹±å¯¸", en:"6 inches", pt:"6 polegadas" }, price:38 },
{ id:"v2", names:{ cn:"8è‹±å¯¸", en:"8 inches", pt:"8 polegadas" }, price:50 }
] }
              ],
              "custom": [
{ id:"u1", img:"https://dyj6gt4964deb.cloudfront.net/images/38bf480f-d413-4b0f-af13-16ec39957a35.jpeg",
title:{ cn:"ç¬‘è„¸è›‹ç³•", en:"Smiley Face Cake", pt:"Bolo de Carinha Sorridente" },
desc:{ cn:"", en:"", pt:"" },
variants:[
{ id:"v1", names:{ cn:"6è‹±å¯¸", en:"6 inches", pt:"6 polegadas" }, price:36 },
{ id:"v2", names:{ cn:"8è‹±å¯¸", en:"8 inches", pt:"8 polegadas" }, price:48 },
{ id:"v3", names:{ cn:"4è‹±å¯¸", en:"4 inches", pt:"4 polegadas" }, price:26 }
] },
{ id:"u2", img:"https://dyj6gt4964deb.cloudfront.net/images/crop-59f36d43-d489-43f6-a753-fa06a9948136.jpeg",
title:{ cn:"ç²‰è‰²å°ç†Šæ¢¦å¹»è›‹ç³•", en:"Pink Teddy Dream Cake", pt:"Bolo dos Sonhos de Ursinho Rosa" },
desc:{ cn:"", en:"", pt:"" },
variants:[
{ id:"v1", names:{ cn:"6å¯¸", en:"6 inches", pt:"6 polegadas" }, price:43 },
{ id:"v2", names:{ cn:"8å¯¸", en:"8 inches", pt:"8 polegadas" }, price:55 }
] },

{ id:"u3", img:"https://dyj6gt4964deb.cloudfront.net/images/crop-f9a4ec58-a5ae-4382-9e6c-401917fb43fc.jpeg",
title:{ cn:"æƒ…ä¾£å…”å­è›‹ç³•", en:"Couple Rabbit Cake", pt:"Bolo de Coelho Casal" },
desc:{
cn:"å¯é€‰å£å‘³ï¼šå·§å…‹åŠ›ï¼ŒæŸ æª¬ï¼ŒæŠ¹èŒ¶é…¸å¥¶ï¼Œé²œå¥¶æ°´æœ",
en:"Available flavors: chocolate, lemon, matcha yogurt, fresh milk fruit",
pt:"Sabores disponÃ­veis: chocolate, limÃ£o, iogurte matcha, fruta fresca"
},
variants:[
{ id:"v1", names:{ cn:"4å¯¸åŠ é«˜", en:"4 inches double height", pt:"4 polegadas de altura dupla" }, price:39 },
{ id:"v2", names:{ cn:"6å¯¸åŠ é«˜", en:"6 inches double height", pt:"6 polegadas de altura dupla" }, price:55 }
] },
{ id:"u4", img:"https://dyj6gt4964deb.cloudfront.net/images/crop-5a8fbbb9-c8c3-4717-a4fb-8920a1182ec7.jpeg",
title:{ cn:"æƒ…ä¾£ç†Šè›‹ç³•", en:"Couple Bear Cake", pt:"Bolo Casal Urso" },
desc:{
cn:"å¯é€‰å£å‘³ï¼šå·§å…‹åŠ›ï¼ŒæŸ æª¬ï¼ŒæŠ¹èŒ¶é…¸å¥¶ï¼Œé²œå¥¶æ°´æœ",
en:"Cake flavors available: chocolate, lemon, fresh milk fruit, matcha yogurt",
pt:"Sabores de bolo disponÃ­veis: chocolate, limÃ£o, fruta fresca, iogurte matcha"
},
variants:[
{ id:"v1", names:{ cn:"4å¯¸åŠ é«˜", en:"4 inches double height", pt:"4 polegadas de altura dupla" }, price:39 },
{ id:"v2", names:{ cn:"6å¯¸åŠ é«˜", en:"6 inches double height", pt:"6 polegadas de altura dupla" }, price:55 }
] }
              ]
          }
        };

        let state = {
          lang: 'en',
          isSearchMode: false,
          cart: [],
          modal: { item: null, variant: null, qty: 1, editUid: null, editProductId: null, variantQty: {} },
          scroll: { home: { en: 0, pt: 0, cn: 0 } },
          currentCategoryId: null
        };
        
        let __legalTab = 'legal'; // current legal tab

        // ==========================================
        // 2. Language Logic
        // ==========================================
        const LANG_KEY = 'neco_lang_v1';
        const LANG_LOCK_KEY = 'neco_lang_lock_v1';
        function isLangLocked(){ try{ return localStorage.getItem(LANG_LOCK_KEY) === '1'; }catch(e){ return false; } }
        function lockLang(){ try{ localStorage.setItem(LANG_LOCK_KEY, '1'); }catch(e){} }
        function _normLocale(s){ return String(s || '').trim().toLowerCase().replace('_', '-'); }
        function detectSystemLang(){
          const candidates = [];
          if (Array.isArray(navigator.languages)) candidates.push(...navigator.languages);
          if (navigator.language) candidates.push(navigator.language);
          try{ const loc = Intl.DateTimeFormat().resolvedOptions().locale; if (loc) candidates.push(loc); }catch(e){}
          for (const raw of candidates) {
            const l = _normLocale(raw);
            if (!l) continue;
            if (l.startsWith('pt')) return 'pt';
            if (l.startsWith('zh')) return 'cn';
            if (l.startsWith('en')) return 'en';
            if (l.startsWith('cn')) return 'cn';
          }
          return 'en';
        }
        function loadPreferredLang(){
          try{ if (isLangLocked()){ const saved = localStorage.getItem(LANG_KEY); if (saved && ['en','pt','cn'].includes(saved)) return saved; } }catch(e){}
          return detectSystemLang();
        }
        function persistLang(l){ try{ localStorage.setItem(LANG_KEY, l); }catch(e){} }
        
        // ==========================================
        // 3. Cart persistence
        // ==========================================
        const CART_KEY = 'neco_cart_v2';
        function _isValidCartItem(it){ return it && typeof it === 'object' && typeof it.uid === 'string' && typeof it.productId === 'string' && typeof it.variantId === 'string' && typeof it.qty === 'number'; }
        function saveCart(){
          try{
            const data = state.cart.map(it => ({ uid: it.uid, productId: it.productId, variantId: it.variantId, qty: it.qty }));
            localStorage.setItem(CART_KEY, JSON.stringify({ v: 2, updatedAt: Date.now(), cart: data }));
          }catch(e){ console.warn('saveCart failed', e); }
        }
        function loadCart(){
          try{
            const raw = localStorage.getItem(CART_KEY); if(!raw) return;
            const obj = JSON.parse(raw); const arr = (obj && obj.cart) ? obj.cart : obj;
            if(!Array.isArray(arr)) return;
            state.cart = arr.filter(_isValidCartItem).map(it => ({ uid: it.uid, productId: it.productId, variantId: it.variantId, qty: Math.max(1, Number(it.qty) || 1) }));
          }catch(e){ console.warn('loadCart failed', e); }
        }
        function findItemById(productId){
          for(const cat in db.items){ const hit = (db.items[cat] || []).find(p => p.id === productId); if(hit) return hit; }
          return null;
        }
        function resolveCartItem(ci){
          const item = findItemById(ci.productId);
          if(!item){ return { missing: true, uid: ci.uid, qty: ci.qty, productId: ci.productId, variantId: ci.variantId }; }
          const variant = (item.variants || []).find(v => v.id === ci.variantId);
          if(!variant){ return { missing: true, uid: ci.uid, qty: ci.qty, productId: ci.productId, variantId: ci.variantId, img: item.img, title: item.title }; }
          return { missing: false, uid: ci.uid, qty: ci.qty, productId: ci.productId, variantId: ci.variantId, img: item.img, title: item.title, variantNames: variant.names, price: variant.price, _item: item, _variant: variant };
        }

        // ==========================================
        // 4. Texts & Merged Data
        // ==========================================
        const texts = {
          cn: {
            back: "è¿”å›åˆ†ç±»", homeTitle: "ä¸»é¡µ", select: "é€‰æ‹©è§„æ ¼", add: "åŠ å…¥è®¢å•", update: "æ›´æ–°è®¢å•",
            view: "æŸ¥çœ‹è®¢å•", more: "æŸ¥çœ‹è¯¦æƒ…", order: "æˆ‘çš„è®¢å•", total: "æ€»è®¡",
            confirm: "ç¡®è®¤ä¸‹å•", remove: "ç§»é™¤æ­¤å•†å“", empty: "è´­ç‰©è½¦ä¸ºç©º",
            added: "å·²åŠ å…¥è®¢å•", updated: "è®¢å•å·²æ›´æ–°", editHint: "ç‚¹å‡»ç¼–è¾‘",
            searchPh: "æœç´¢è›‹ç³•...", noResult: "æœªæ‰¾åˆ°ç›¸å…³å•†å“", fallback: "å½“å‰è¯­è¨€æ— ç»“æœï¼Œå·²å±•ç¤ºå…¶ä»–è¯­è¨€åŒ¹é…ã€‚",
            missing: "è¯¥å•†å“å·²ä¸‹æ¶æˆ–è§„æ ¼å·²å˜æ›´ï¼Œè¯·ç§»é™¤åé‡æ–°é€‰æ‹©ã€‚",
            missingTitle: "å·²ä¸‹æ¶å•†å“", missingVariant: "è§„æ ¼ä¸å¯ç”¨", removeHintMissing: "è¯·ç§»é™¤",
            // Legal & Footer
            footerBtnLegal: "ä¸»ä½“ä¿¡æ¯", footerBtnTerms: "è´­ä¹°æ¡æ¬¾", footerBtnReturns: "é…é€/é€€æ¢", footerBtnPrivacy: "éšç§ä¸æ•°æ®", footerBtnDisputes: "äº‰è®®/ä»²è£",
            footerNote: "Â© {year} Neco's Custom Cake Â· ä¿ç•™æ‰€æœ‰æƒåˆ©ã€‚",
            legalTitle: "æ³•å¾‹ä¿¡æ¯ä¸æ”¿ç­–", tabLegal: "ä¸»ä½“ä¿¡æ¯", tabTerms: "è´­ä¹°æ¡æ¬¾", tabReturns: "é…é€/é€€æ¢", tabPrivacy: "éšç§ä¸æ•°æ®", tabDisputes: "äº‰è®®/ä»²è£",
            scopeH2: "èŒƒå›´è¯´æ˜", scopeP: "æœ¬ç½‘ç«™ç”¨äºå±•ç¤ºäº§å“å¹¶æ¥å—å®¢æˆ·ä¸‹å•ã€‚ä½¿ç”¨æœ¬ç½‘ç«™å³è¡¨ç¤ºä½ åŒæ„ä»¥ä¸‹æ¡æ¬¾ã€‚",
            contactsH2: "è”ç³»æ–¹å¼", contactsP: "å¦‚éœ€å’¨è¯¢ä¸‹å•ã€é…é€ã€é€€æ¢è´§æˆ–éšç§é—®é¢˜ï¼Œè¯·ä½¿ç”¨ä¸Šæ–¹ä¿¡æ¯ä¸æˆ‘ä»¬è”ç³»ã€‚",
            termsH2_1: "è´­ä¹°æ¡æ¬¾ä¸æ¡ä»¶", termsP1: "æœ¬æ¡æ¬¾é€‚ç”¨äºé€šè¿‡æœ¬ç½‘ç«™è¿›è¡Œçš„æ‰€æœ‰è´­ä¹°ã€‚å»ºè®®ä¸‹å•å‰ä»”ç»†é˜…è¯»ã€‚",
            termsH2_2: "ä¸‹å•ä¸ä»˜æ¬¾", termsList2: ["ï¼ˆå¦‚é€‚ç”¨ï¼‰ä»˜æ¬¾å®Œæˆä¸”æˆ‘ä»¬ç¡®è®¤å¯åˆ¶ä½œåï¼Œè®¢å•æ‰ç®—ç¡®è®¤ã€‚", "å®šåˆ¶/ä¸ªæ€§åŒ–äº§å“é€šå¸¸éœ€è¦æå‰é¢„çº¦ï¼Œæˆ‘ä»¬ä¼šé€šè¿‡æ¶ˆæ¯ç¡®è®¤äº¤ä»˜/è‡ªå–æ—¥æœŸã€‚", "å¦‚éœ€å–æ¶ˆæˆ–ä¿®æ”¹ï¼Œè¯·å°½å¿«è”ç³»ï¼›å¼€å§‹åˆ¶ä½œåå¯èƒ½æ— æ³•æ›´æ”¹ã€‚"],
            termsH2_3: "ä»·æ ¼", termsP3: "æ‰€æœ‰ä»·æ ¼ä»¥æ¬§å…ƒï¼ˆâ‚¬ï¼‰æ˜¾ç¤ºï¼Œå¯èƒ½ä¼šè°ƒæ•´ã€‚ç¨è´¹å°†æŒ‰æ³•å¾‹è¦æ±‚é€‚ç”¨ã€‚",
            returnsH2_1: "é…é€ / è‡ªå–", returnsList1: ["é…é€èŒƒå›´ï¼š{deliveryArea}", "é¢„è®¡é…é€æ—¶é—´ï¼š{deliveryTime}", "é…é€è´¹ç”¨ï¼š{deliveryFee}", "å¯æŒ‰æ¶ˆæ¯çº¦å®šè‡ªå–ã€‚"],
            returnsH2_2: "é€€æ¢è´§è§„åˆ™", returnsList2: ["ç”±äºä¸ºé£Ÿå“ï¼ˆæ˜“è…ï¼‰ä¸/æˆ–å®šåˆ¶äº§å“ï¼Œå¼€å§‹åˆ¶ä½œåé€šå¸¸ä¸æ”¯æŒæ— ç†ç”±é€€è´§ã€‚", "è‹¥æ”¶åˆ°æŸåæˆ–æœ‰è¯¯ï¼Œè¯·åœ¨ 24 å°æ—¶å†…æä¾›ç…§ç‰‡è”ç³»æˆ‘ä»¬ï¼Œæˆ‘ä»¬ä¼šç»™å‡ºè§£å†³æ–¹æ¡ˆï¼ˆè¡¥å‘æˆ–é€€æ¬¾ï¼‰ã€‚", "å¦‚æ‰¹å‡†é€€æ¬¾ï¼Œå°†åœ¨åˆç†æ—¶é—´å†…æŒ‰åŸæ”¯ä»˜æ–¹å¼é€€å›ã€‚"],
            returnsMuted: "æç¤ºï¼šå®šåˆ¶è›‹ç³•è¯·åœ¨ç¡®è®¤å‰æ ¸å¯¹æ–‡å­—ã€æ—¥æœŸä¸è®¾è®¡è¦æ±‚ã€‚",
            privacyH2_1: "æ•°æ®ä¿æŠ¤ï¼ˆRGPD/GDPRï¼‰", privacyP1: "æˆ‘ä»¬éµå®ˆ RGPD/GDPR å¤„ç†ä¸ªäººæ•°æ®ï¼Œä»…ç”¨äºè®¢å•ç®¡ç†ã€é…é€/è‡ªå–ã€å¼€ç¥¨ä¸å”®åæ”¯æŒã€‚",
            privacyH2_2: "æˆ‘ä»¬æ”¶é›†å“ªäº›æ•°æ®", privacyList2: ["èº«ä»½ä¸è”ç³»æ–¹å¼ï¼ˆå§“åã€ç”µè¯ã€é‚®ç®±ï¼‰ã€‚", "éœ€è¦é…é€æ—¶çš„åœ°å€ä¿¡æ¯ã€‚", "ä¸ºå®Œæˆè®¢å•æ‰€éœ€çš„è®¢å•å†…å®¹ä¸æ²Ÿé€šè®°å½•ã€‚", "åŸºç¡€åŠŸèƒ½æ‰€éœ€çš„æŠ€æœ¯æ•°æ®ï¼ˆå¦‚è¯­è¨€/è´­ç‰©è½¦ cookiesï¼‰ã€‚"],
            privacyH2_3: "ä½ çš„æƒåˆ©", privacyList3: ["æŸ¥è¯¢ã€æ›´æ­£æˆ–åˆ é™¤ä½ çš„æ•°æ®ï¼ˆé€‚ç”¨æ—¶ï¼‰ã€‚", "å½“å¤„ç†åŸºäºåŒæ„æ—¶ï¼Œå¯æ’¤å›åŒæ„ã€‚", "è¯·æ±‚äº†è§£ä½ çš„æ•°æ®å¦‚ä½•è¢«ä½¿ç”¨ã€‚"],
            privacyH2_4: "Cookies", privacyP4: "æˆ‘ä»¬å¯èƒ½ä½¿ç”¨ cookies ç”¨äºåŸºç¡€åŠŸèƒ½ï¼ˆä¾‹å¦‚è¯­è¨€ä¸è´­ç‰©è½¦ï¼‰ã€‚ä½ å¯åœ¨æµè§ˆå™¨è®¾ç½®ä¸­ç®¡ç† cookiesã€‚",
            disputesH2_1: "æ›¿ä»£æ€§äº‰è®®è§£å†³ï¼ˆä»²è£ï¼‰", disputesP1: "å¦‚å‘ç”Ÿæ¶ˆè´¹äº‰è®®ï¼Œæ¶ˆè´¹è€…å¯ä½¿ç”¨ä¸‹æ–¹æ‰€åˆ—çš„æ›¿ä»£æ€§äº‰è®®è§£å†³æœºæ„ï¼ˆä»²è£ä¸­å¿ƒ/ Centro de Arbitragemï¼‰ã€‚",
            disputesH2_2: "åœ¨çº¿äº‰è®®è§£å†³ï¼ˆODRï¼‰", disputesP2: "æ¬§ç›Ÿæ¶ˆè´¹è€…ä¹Ÿå¯ä½¿ç”¨æ¬§æ´²åœ¨çº¿äº‰è®®è§£å†³å¹³å°ï¼ˆODRï¼‰ã€‚"
          },
          en: {
            back: "Back", homeTitle: "Home", select: "Select Size", add: "Add to Order", update: "Update Order",
            view: "View Order", more: "More Info", order: "Your Order", total: "Total",
            confirm: "Confirm", remove: "Remove Item", empty: "Empty Cart",
            added: "Added to Order", updated: "Order Updated", editHint: "Edit item",
            searchPh: "Search cakes...", noResult: "No results found", fallback: "No results in English, showing matches from other languages.",
            missing: "Item unavailable (menu updated). Please remove and re-add.",
            missingTitle: "Unavailable item", missingVariant: "Variant unavailable", removeHintMissing: "REMOVE",
            // Legal & Footer
            footerBtnLegal: "Legal info", footerBtnTerms: "Terms", footerBtnReturns: "Exchanges & Returns", footerBtnPrivacy: "Privacy", footerBtnDisputes: "Dispute Resolution",
            footerNote: "Â© {year} Neco's Custom Cake Â· All rights reserved.",
            legalTitle: "Legal & Policies", tabLegal: "Legal", tabTerms: "Terms", tabReturns: "Returns", tabPrivacy: "Privacy", tabDisputes: "Disputes",
            scopeH2: "Scope", scopeP: "This website is used to present products and allow customers to place orders. By using this website, you agree to the terms below.",
            contactsH2: "Contacts", contactsP: "For any questions about orders, delivery, returns or privacy, please contact us using the details above.",
            termsH2_1: "Terms & Conditions of Purchase", termsP1: "These terms apply to all purchases made through this website. We recommend you read them carefully before placing your order.",
            termsH2_2: "Orders & Payment", termsList2: ["Orders are confirmed after payment is completed (when applicable) and after we confirm availability.", "Custom/Personalized products may require advance notice. We will confirm the delivery/pickup date by message.", "If you need to cancel or change an order, contact us as soon as possible. Changes may not be possible once preparation starts."],
            termsH2_3: "Prices", termsP3: "All prices are shown in euros (â‚¬) and may change without prior notice. Taxes will be applied as legally required.",
            returnsH2_1: "Delivery / Pickup", returnsList1: ["Delivery area: {deliveryArea}", "Estimated delivery time: {deliveryTime}", "Delivery fee: {deliveryFee}", "Pickup is available when agreed by message."],
            returnsH2_2: "Exchanges & Returns", returnsList2: ["Because we sell perishable food and personalized items, returns for change-of-mind may not apply once production starts.", "If you receive a damaged product or there is a mistake, contact us within 24 hours with photos, and we will propose a solution (replacement or refund).", "Refunds, when approved, are processed using the original payment method within a reasonable timeframe."],
            returnsMuted: "Note: For customized cakes, please double-check the text, dates, and design requests before confirmation.",
            privacyH2_1: "Data Protection (RGPD/GDPR)", privacyP1: "We process personal data in accordance with the RGPD/GDPR. Data is used only to manage orders, delivery/pickup, invoicing and customer support.",
            privacyH2_2: "What data we collect", privacyList2: ["Identification and contact details (name, phone, email).", "Delivery information (address) when delivery is requested.", "Order details and messages needed to fulfil the order.", "Technical data such as cookies (if enabled) for basic site functionality."],
            privacyH2_3: "Your rights", privacyList3: ["Access, rectify or delete your data (when applicable).", "Withdraw consent where processing is based on consent.", "Request information about how your data is used."],
            privacyH2_4: "Cookies", privacyP4: "Cookies may be used to improve basic functionality (e.g., language and cart). You can manage cookies in your browser settings.",
            disputesH2_1: "Alternative Dispute Resolution", disputesP1: "In case of dispute, the consumer may resort to an Alternative Dispute Resolution entity (Centro de Arbitragem) as indicated below.",
            disputesH2_2: "Online Dispute Resolution (ODR)", disputesP2: "Consumers in the EU may also use the European Online Dispute Resolution platform (ODR)."
          },
          pt: {
            back: "Voltar", homeTitle: "InÃ­cio", select: "Selecione o Tamanho", add: "Adicionar", update: "Atualizar",
            view: "Ver Pedido", more: "Mais Info", order: "Seu Pedido", total: "Total",
            confirm: "Confirmar", remove: "Remover Item", empty: "Carrinho Vazio",
            added: "Adicionado", updated: "Atualizado", editHint: "Editar item",
            searchPh: "Pesquisar bolos...", noResult: "Nenhum resultado", fallback: "Sem resultados em PortuguÃªs, a mostrar outras lÃ­nguas.",
            missing: "Item indisponÃ­vel (menu atualizado). Remova e adicione novamente.",
            missingTitle: "Item indisponÃ­vel", missingVariant: "Variante indisponÃ­vel", removeHintMissing: "REMOVER",
            // Legal & Footer
            footerBtnLegal: "InformaÃ§Ã£o Legal", footerBtnTerms: "Termos", footerBtnReturns: "Trocas/DevoluÃ§Ãµes", footerBtnPrivacy: "Privacidade", footerBtnDisputes: "ResoluÃ§Ã£o de LitÃ­gios",
            footerNote: "Â© {year} Neco's Custom Cake Â· Todos os direitos reservados.",
            legalTitle: "InformaÃ§Ã£o Legal & PolÃ­ticas", tabLegal: "Legal", tabTerms: "Termos", tabReturns: "Trocas/DevoluÃ§Ãµes", tabPrivacy: "Privacidade", tabDisputes: "LitÃ­gios",
            scopeH2: "Ã‚mbito", scopeP: "Este website apresenta produtos e permite efetuar encomendas. Ao utilizar este website, concorda com os termos abaixo.",
            contactsH2: "Contactos", contactsP: "Para questÃµes sobre encomendas, entrega, devoluÃ§Ãµes ou privacidade, contacte-nos atravÃ©s dos dados acima.",
            termsH2_1: "Termos e CondiÃ§Ãµes de Compra", termsP1: "Estes termos aplicam-se a todas as compras efetuadas atravÃ©s deste website. Recomendamos a leitura antes de efetuar a encomenda.",
            termsH2_2: "Encomendas & Pagamento", termsList2: ["As encomendas sÃ£o confirmadas apÃ³s pagamento (quando aplicÃ¡vel) e confirmaÃ§Ã£o de disponibilidade.", "Produtos personalizados podem exigir aviso prÃ©vio. Confirmaremos a data de entrega/recolha por mensagem.", "Para cancelar ou alterar uma encomenda, contacte-nos o mais cedo possÃ­vel. AlteraÃ§Ãµes podem nÃ£o ser possÃ­veis apÃ³s inÃ­cio de preparaÃ§Ã£o."],
            termsH2_3: "PreÃ§os", termsP3: "Todos os preÃ§os sÃ£o apresentados em euros (â‚¬) e podem ser alterados sem aviso prÃ©vio. Impostos serÃ£o aplicados conforme exigido por lei.",
            returnsH2_1: "Entrega / Recolha", returnsList1: ["Zona de entrega: {deliveryArea}", "Prazo estimado: {deliveryTime}", "Custo de entrega: {deliveryFee}", "Recolha disponÃ­vel mediante acordo por mensagem."],
            returnsH2_2: "Trocas & DevoluÃ§Ãµes", returnsList2: ["Sendo produtos alimentares perecÃ­veis e/ou personalizados, a devoluÃ§Ã£o por arrependimento pode nÃ£o ser aplicÃ¡vel apÃ³s inÃ­cio de produÃ§Ã£o.", "Se receber um produto danificado ou com erro, contacte-nos no prazo de 24 horas com fotografias, e apresentaremos uma soluÃ§Ã£o (substituiÃ§Ã£o ou reembolso).", "Reembolsos aprovados sÃ£o processados pelo mesmo mÃ©todo de pagamento num prazo razoÃ¡vel."],
            returnsMuted: "Nota: Para bolos personalizados, confirme cuidadosamente texto, datas e pedidos de design antes da confirmaÃ§Ã£o.",
            privacyH2_1: "ProteÃ§Ã£o de Dados (RGPD)", privacyP1: "Tratamos dados pessoais de acordo com o RGPD. Os dados sÃ£o utilizados apenas para gerir encomendas, entrega/recolha, faturaÃ§Ã£o e apoio ao cliente.",
            privacyH2_2: "Que dados recolhemos", privacyList2: ["Dados de identificaÃ§Ã£o e contacto (nome, telefone, email).", "Dados de entrega (morada) quando solicitado.", "Detalhes da encomenda e mensagens necessÃ¡rias para execuÃ§Ã£o.", "Dados tÃ©cnicos como cookies (se ativos) para funcionalidades bÃ¡sicas do site."],
            privacyH2_3: "Os seus direitos", privacyList3: ["Aceder, retificar ou apagar dados (quando aplicÃ¡vel).", "Retirar consentimento quando o tratamento se baseia em consentimento.", "Solicitar informaÃ§Ã£o sobre como os dados sÃ£o utilizados."],
            privacyH2_4: "Cookies", privacyP4: "Podem ser usados cookies para funcionalidades bÃ¡sicas (ex.: idioma e carrinho). Pode gerir cookies nas definiÃ§Ãµes do seu navegador.",
            disputesH2_1: "ResoluÃ§Ã£o Alternativa de LitÃ­gios", disputesP1: "Em caso de litÃ­gio, o consumidor pode recorrer a uma entidade de ResoluÃ§Ã£o Alternativa de LitÃ­gios (Centro de Arbitragem) indicada abaixo.",
            disputesH2_2: "ResoluÃ§Ã£o de LitÃ­gios em Linha (ODR)", disputesP2: "Consumidores na UE tambÃ©m podem utilizar a plataforma europeia de ResoluÃ§Ã£o de LitÃ­gios em Linha (ODR)."
          }
        };

        let __lastSystemLang = detectSystemLang();
        function applySystemLangIfUnlocked(){
          if (isLangLocked()) return;
          const sys = detectSystemLang();
          if (sys !== state.lang){ setLang(sys, false); }
          __lastSystemLang = sys;
        }
        function startAutoLangWatch(){
          window.addEventListener('languagechange', applySystemLangIfUnlocked);
          setInterval(() => { if (isLangLocked()) return; const now = detectSystemLang(); if (now !== __lastSystemLang){ applySystemLangIfUnlocked(); } }, 2000);
        }

        function init() {
            loadCart();
            const initialLang = loadPreferredLang();
            setLang(initialLang, false);
            startAutoLangWatch();
            updateCartBar();
            if (!history.state || !history.state.view) { history.replaceState({ view: 'home' }, ''); }
            fillLegalTexts(); // Fill footer texts on init
        }

        function safeText(v){ return (v===undefined || v===null) ? "" : String(v); }

        function setLang(l, userChosen = false) {
          if (!['en','pt','cn'].includes(l)) l = 'en';
          state.lang = l;
          if (userChosen){ persistLang(l); lockLang(); }
          document.documentElement.lang = (l === 'cn') ? 'zh-CN' : l;
          document.querySelectorAll('.lang-btn').forEach(b => {
            b.classList.toggle('active', b.innerText.toLowerCase() === l);
          });
          updateUI();
          fillLegalTexts(); // Update legal modal and footer
          if(state.isSearchMode) handleSearch();
        }

        function onSearchKeyDown(e) {
          if (e.key === 'Enter') { e.preventDefault(); e.target.blur(); handleSearch(); }
        }

        function updateTopButtonLabel() {
          const isHome = document.getElementById('view-home').classList.contains('active');
          const t = texts[state.lang];
          const txt = document.getElementById('txt-back');
          if (txt) txt.innerText = isHome ? t.homeTitle : t.back;
          const nav = document.querySelector('.back-nav');
          if (!nav) return;
          if (isHome) {
            nav.style.setProperty('--nav-icon', 'url("https://i.ibb.co/kVS4zpC5/IMG-20251219-152124.png")');
            nav.style.setProperty('--nav-icon-size', '22.5px');
          } else {
            nav.style.setProperty('--nav-icon', 'url("https://lestoy.com/love/icones/back.svg")');
            nav.style.setProperty('--nav-icon-size', '18px');
          }
        }

        function updateUI() {
            const t = texts[state.lang];
            const ids = {
                'txt-view-order': t.view, 'txt-your-order': t.order,
                'txt-select-size': t.select,
                'txt-total': t.total, 'txt-remove': t.remove,
                'txt-confirm': t.confirm
            };
            for(let id in ids) { const el = document.getElementById(id); if(el) el.innerText = ids[id]; }
            document.getElementById('search-input').placeholder = t.searchPh;
            if (document.getElementById('view-home').classList.contains('active') && !state.isSearchMode) {
              state.scroll.home[state.lang] = window.scrollY || 0;
              renderHome(true);
            } else if (!state.isSearchMode) {
              if (document.getElementById('view-category').classList.contains('active') && state.currentCategoryId) {
                const y = window.scrollY || 0;
                renderCategory(state.currentCategoryId, { skipSaveHome: true, keepScrollY: y });
              }
            }
            const hint = state.lang === 'cn' ? 'search' : 'search';
            document.getElementById('search-input').setAttribute('enterkeyhint', hint);
            updateCartBar();
            if(document.getElementById('cart-modal').style.display === 'flex') openCartModal();
            refreshProductModalUI();
            updateTopButtonLabel();
        }

        function renderHome(restoreScroll = false) {
          const grid = document.getElementById('category-grid');
          grid.innerHTML = db.categories.map(c => {
              const key = `home-cat-${c.id}`;
              return `
                <div class="${__cardClass(key,'cat-card')}" data-reveal-key="${key}" onclick="renderCategory('${c.id}')">
                    <div class="cat-img-box"><img src="${c.img}" class="${__imgClass(c.img,'cat-img')}" ${__imgDataAttrs(c.img)} loading="lazy" alt=""></div>
                    <div class="cat-info">
                        <div class="cat-title">${c.title[state.lang]}</div>
                        <div class="cat-desc">${c.desc[state.lang]}</div>
                    </div>
                </div>
              `;
          }).join('');
          initCardFX(grid);
          const saved = state.scroll.home[state.lang] || 0;
          switchView('view-home', restoreScroll ? { scrollTop: saved } : {});
        }

        function renderCategory(id, opts = {}) {
          state.currentCategoryId = id;
          history.pushState({ view: 'category' }, '');
          if (!opts.skipSaveHome) { state.scroll.home[state.lang] = window.scrollY || window.pageYOffset || 0; }
          const items = db.items[id] || [];
          const container = document.getElementById('category-content');
          renderProductList(container, items, id);
          if (typeof opts.keepScrollY === 'number') { switchView('view-category', { scrollTop: opts.keepScrollY }); } else { switchView('view-category'); }
        }

        function renderProductList(container, items, catId) {
            container.innerHTML = `
                <div class="product-list">
                    ${items.map((item, idx) => {
                      const key = `prod-${item.id}`;
                      return `
                        <div class="${__cardClass(key,'prod-card')}" data-reveal-key="${key}">
                            <img src="${item.img}" class="${__imgClass(item.img,'prod-img')}" ${__imgDataAttrs(item.img)} loading="lazy" alt="">
                            <div class="prod-body">
                                <div class="prod-title">${item.title[state.lang] || item.title['en']}</div>
                                <div class="prod-desc">${item.desc[state.lang] || item.desc['en']}</div>
                                <div class="prod-footer">
                                    <button class="btn-action" onclick="openProductModal('${item._catId || catId}', ${item._idx !== undefined ? item._idx : idx})">
                                        ${texts[state.lang].more}
                                    </button>
                                </div>
                            </div>
                        </div>
                      `;
                    }).join('')}
                </div>
            `;
            initCardFX(container);
        }

        function switchView(viewId, opts = {}) {
          document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
          document.getElementById(viewId).classList.add('active');
          updateTopButtonLabel();
          if (opts.noScroll) return;
          const top = typeof opts.scrollTop === 'number' ? opts.scrollTop : 0;
          requestAnimationFrame(() => window.scrollTo(0, top));
        }

        function goBack() {
          const isHome = document.getElementById('view-home').classList.contains('active');
          if (isHome) return;
          if (state.isSearchMode) clearSearch();
          else renderHome(true);
        }

        function handleSearch() {
            const query = document.getElementById('search-input').value.trim().toLowerCase();
            document.getElementById('search-clear').style.display = query.length > 0 ? 'block' : 'none';
            if(query.length < 1) { if(state.isSearchMode) { state.isSearchMode = false; renderHome(); } return; }
            if (!state.isSearchMode) { history.pushState({ view: 'search' }, ''); }
            state.isSearchMode = true;
            let allItems = [];
            for(let cat in db.items) { db.items[cat].forEach((item, idx) => { item._catId = cat; item._idx = idx; allItems.push(item); }); }
            const lang = state.lang;
            let results = allItems.filter(item => {
                const t = (item.title[lang] || '').toLowerCase();
                const d = (item.desc[lang] || '').toLowerCase();
                return t.includes(query) || d.includes(query);
            });
            if(results.length === 0) {
                results = allItems.filter(item => {
                    return Object.values(item.title).some(v => v.toLowerCase().includes(query)) || Object.values(item.desc).some(v => v.toLowerCase().includes(query));
                });
            }
            const container = document.getElementById('category-content');
            if(results.length > 0) { renderProductList(container, results, null); } else { container.innerHTML = `<div style="text-align:center; padding:40px; color:#999;">${texts[state.lang].noResult}</div>`; }
            switchView('view-category');
        }
        function clearSearch() {
            document.getElementById('search-input').value = '';
            document.getElementById('search-clear').style.display = 'none';
            state.isSearchMode = false;
            renderHome();
        }

        // ===== Lock body scroll =====
        let __lockedScrollY = 0;
        function lockBodyScroll(){
          if(document.body.classList.contains('modal-open')) return;
          __lockedScrollY = window.scrollY || window.pageYOffset || 0;
          document.body.style.top = `-${__lockedScrollY}px`;
          document.body.classList.add('modal-open');
        }
        function unlockBodyScroll(){
          if(!document.body.classList.contains('modal-open')) return;
          document.body.classList.remove('modal-open');
          document.body.style.top = '';
          window.scrollTo(0, __lockedScrollY);
        }
        function unlockBodyScrollIfNoModal(){
          const pm = document.getElementById('product-modal');
          const cm = document.getElementById('cart-modal');
          const lm = document.getElementById('legal-modal');
          const anyOpen = (pm && pm.style.display === 'flex') || (cm && cm.style.display === 'flex') || (lm && lm.style.display === 'flex');
          if(anyOpen) return;
          unlockBodyScroll();
        }

        // --- Product Modal Logic ---
        function getProductQtyMapFromCart(productId){
            const preset = {};
            for(const ci of state.cart){ if(ci.productId === productId){ preset[ci.variantId] = (preset[ci.variantId] || 0) + (Number(ci.qty) || 0); } }
            return preset;
        }
        function buildVariantQtyMap(item, preset){
            const m = {};
            (item.variants || []).forEach(v => { const q = preset && preset[v.id] !== undefined ? Number(preset[v.id]) : 0; m[v.id] = Math.max(0, isFinite(q) ? q : 0); });
            return m;
        }
        function renderVariantQtyList(){
            const item = state.modal.item;
            const vList = document.getElementById('variant-list');
            if(!item || !vList) return;
            vList.innerHTML = (item.variants || []).map(v => {
                const name = v.names[state.lang] || v.names['en'];
                const priceText = `â‚¬ ${Number(v.price).toFixed(2)}`;
                const q = state.modal.variantQty[v.id] || 0;
                return `
                <div class="v-item" data-vid="${v.id}">
                    <div class="v-left">
                        <span class="v-name">${name}</span>
                        <span class="v-subprice">${priceText}</span>
                    </div>
                    <div class="v-qty">
                        <div class="v-qty-btn" onclick="event.stopPropagation(); adjustVariantQty('${v.id}', -1)">-</div>
                        <span class="v-qty-val" id="v-qty-${v.id}">${q}</span>
                        <div class="v-qty-btn" onclick="event.stopPropagation(); adjustVariantQty('${v.id}', 1)">+</div>
                    </div>
                </div>
                `;
            }).join('');
        }
        function adjustVariantQty(variantId, delta){
            if(!state.modal || !state.modal.variantQty) return;
            const cur = Number(state.modal.variantQty[variantId]) || 0;
            let next = cur + delta;
            if(next < 0) next = 0;
            state.modal.variantQty[variantId] = next;
            const el = document.getElementById('v-qty-' + variantId);
            if(el) el.innerText = next;
            updateModalPrice();
        }
        function _formatCtaText(qty, amount){
          const a = `â‚¬${Number(amount).toFixed(2)}`; const dot = ' Â· ';
          if(state.lang === 'cn') return `æ·»åŠ ${qty}${dot}${a}`;
          if(state.lang === 'pt') return `Adicionar ${qty}${dot}${a}`;
          return `Add ${qty}${dot}${a}`;
        }
        function refreshProductModalUI(){
            if(document.getElementById('product-modal').style.display !== 'flex') return;
            const item = state.modal.item;
            if(!item) return;
            document.getElementById('m-title').innerText = item.title[state.lang] || item.title['en'];
            document.getElementById('m-desc').innerText = item.desc[state.lang] || item.desc['en'];
            renderVariantQtyList();
            updateModalPrice();
        }
        function openProductModal(catId, itemIdx, editCartItem = null) {
            let item;
            let preset = {};
            if (editCartItem) {
                item = findItemById(editCartItem.productId);
                if(!item){ showToast(texts[state.lang].missing); return; }
                preset = getProductQtyMapFromCart(item.id);
                state.modal.editProductId = item.id;
            } else {
                item = db.items[catId][itemIdx];
                state.modal.editProductId = null;
            }
            state.modal.item = item;
            state.modal.variantQty = buildVariantQtyMap(item, preset);
            document.getElementById('m-img').src = item.img;
            document.getElementById('m-title').innerText = item.title[state.lang] || item.title['en'];
            document.getElementById('m-desc').innerText = item.desc[state.lang] || item.desc['en'];
            renderVariantQtyList();
            updateModalPrice();
            const modal = document.getElementById('product-modal');
            const shell = document.getElementById('modal-shell');
            lockBodyScroll();
            modal.style.display = 'flex';
            modal.style.opacity = 1;
            requestAnimationFrame(() => shell.classList.add('open'));
            history.pushState({ modal: true }, '');
        }
        function updateModalPrice() {
            const item = state.modal.item;
            if(!item) return;
            let totalQty = 0;
            let total = 0;
            (item.variants || []).forEach(v => {
              const q = Number(state.modal.variantQty && state.modal.variantQty[v.id]) || 0;
              totalQty += q;
              total += q * (Number(v.price) || 0);
            });
            const label = document.getElementById('txt-add-btn');
            if(label) label.innerText = _formatCtaText(totalQty, total);
            const btn = document.querySelector('#product-modal .btn-add-cart');
            if(btn){ btn.disabled = totalQty <= 0; btn.style.opacity = totalQty <= 0 ? 0.6 : 1; }
        }
        function _hideProductModal() {
          const modal = document.getElementById('product-modal');
          const shell = document.getElementById('modal-shell');
          shell.classList.remove('open');
          modal.style.opacity = 0;
          state.modal.editProductId = null;
          state.modal.variantQty = {};
          setTimeout(() => { modal.style.display = 'none'; unlockBodyScrollIfNoModal(); }, 300);
        }
        function closeModalDirect() { _hideProductModal(); }
        function closeModal(e) { if(e.target.id === 'product-modal') closeModalDirect(); }

        // --- Cart Logic ---
        function confirmAddToCart() {
            const item = state.modal.item;
            const qtyMap = state.modal.variantQty || {};
            if(!item) return;
            const isEdit = !!state.modal.editProductId;
            let picked = 0;
            for(const v of (item.variants || [])){ picked += (Number(qtyMap[v.id]) || 0); }
            if(picked <= 0){ showToast(state.lang === 'cn' ? 'å…ˆæ¥ç‚¹æ•°é‡å‘€ï½' : (state.lang === 'pt' ? 'Escolha uma quantidade ğŸ™‚' : 'Pick a qty ğŸ™‚')); return; }
            if (isEdit) {
                for (const v of (item.variants || [])) {
                    const desired = Math.max(0, Number(qtyMap[v.id]) || 0);
                    const existing = state.cart.find(c => c.productId === item.id && c.variantId === v.id);
                    if (desired > 0) {
                        if (existing) existing.qty = desired;
                        else state.cart.push({ uid: String(Date.now() + Math.random()), productId: item.id, variantId: v.id, qty: desired });
                    } else {
                        if (existing) state.cart.splice(state.cart.indexOf(existing), 1);
                    }
                }
            } else {
                for (const v of (item.variants || [])) {
                    const addQty = Math.max(0, Number(qtyMap[v.id]) || 0);
                    if (addQty <= 0) continue;
                    const existing = state.cart.find(c => c.productId === item.id && c.variantId === v.id);
                    if (existing) existing.qty += addQty;
                    else state.cart.push({ uid: String(Date.now() + Math.random()), productId: item.id, variantId: v.id, qty: addQty });
                }
            }
            closeModalDirect();
            saveCart();
            updateCartBar();
            showToast(isEdit ? texts[state.lang].updated : texts[state.lang].added);
            if(document.getElementById('cart-modal').style.display === 'flex') openCartModal();
        }
        function updateCartBar() {
            let totalQty = 0;
            let totalPrice = 0;
            for(const ci of state.cart){
              totalQty += ci.qty;
              const r = resolveCartItem(ci);
              if(!r.missing) totalPrice += (r.price * r.qty);
            }
            const countEl = document.getElementById('cart-count');
            if(countEl) countEl.innerText = totalQty;
            const legacyTotalEl = document.getElementById('cart-bar-total');
            if(legacyTotalEl) legacyTotalEl.innerText = `â‚¬ ${totalPrice.toFixed(2)}`;
            const labelEl = document.getElementById('sticky-cart-label');
            if(labelEl){
              const view = texts[state.lang].view || 'View';
              labelEl.innerText = `${view}`;
            }
            const stickyCart = document.getElementById('sticky-cart');
            if (stickyCart) stickyCart.style.display = totalQty > 0 ? 'flex' : 'none';
        }
        function openCartModal() {
          const list = document.getElementById('cart-list');
          list.innerHTML = '';
          if (state.cart.length === 0) {
            list.innerHTML = `<div style="text-align:center; padding:40px; color:#999;">${texts[state.lang].empty}</div>`;
          } else {
            state.cart.forEach((ci) => {
              const r = resolveCartItem(ci);
              const div = document.createElement('div');
              div.className = 'cart-item';
              div.onclick = (e) => {
                if (e.target.closest('.mini-btn')) return;
                if (r.missing) { showToast(texts[state.lang].missing); return; }
                openProductModal(null, null, ci);
              };
              const img = r.img || 'https://via.placeholder.com/140x140?text=%20';
              const title = r.title ? (r.title[state.lang] || r.title['en']) : texts[state.lang].missingTitle;
              const sku = r.variantNames ? (r.variantNames[state.lang] || r.variantNames['en']) : texts[state.lang].missingVariant;
              const lineTotal = (!r.missing && typeof r.price === 'number') ? (r.price * r.qty) : 0;
              const hintText = r.missing ? texts[state.lang].removeHintMissing : texts[state.lang].editHint;
              div.innerHTML = `
                <img src="${img}" class="cart-img">
                <div class="cart-info">
                  <div class="c-title">${title}</div>
                  <div class="c-sku">${sku}</div>
                  <div class="c-price">â‚¬ ${lineTotal.toFixed(2)}</div>
                </div>
                <div class="cart-actions">
                  <div class="mini-qty">
                    <div class="mini-btn" onclick="updateCartItemQty('${ci.uid}', -1)">-</div>
                    <span style="margin:0 5px;">${ci.qty}</span>
                    <div class="mini-btn" onclick="updateCartItemQty('${ci.uid}', 1)">+</div>
                  </div>
                  <div class="edit-hint">${hintText}</div>
                </div>
              `;
              list.appendChild(div);
            });
          }
          let total = 0;
          for (const ci of state.cart) { const r = resolveCartItem(ci); if (!r.missing) total += (r.price * r.qty); }
          document.getElementById('cart-modal-total').innerText = `â‚¬ ${total.toFixed(2)}`;
          const modal = document.getElementById('cart-modal');
          const shell = document.getElementById('cart-shell');
          lockBodyScroll();
          modal.style.display = 'flex';
          modal.style.opacity = 1;
          requestAnimationFrame(() => shell.classList.add('open'));
          history.pushState({ modal: true }, '');
        }
        function updateCartItemQty(uid, delta) {
            const item = state.cart.find(c => c.uid === uid);
            if(item) {
                item.qty += delta;
                if(item.qty <= 0) state.cart.splice(state.cart.indexOf(item), 1);
                saveCart();
                updateCartBar();
                openCartModal();
            }
        }
        function _hideCartModal() {
          const modal = document.getElementById('cart-modal');
          const shell = document.getElementById('cart-shell');
          shell.classList.remove('open');
          modal.style.opacity = 0;
          setTimeout(() => { modal.style.display = 'none'; unlockBodyScrollIfNoModal(); }, 300);
        }
        function closeCartDirect() { _hideCartModal(); }
        function closeCart(e) { if(e.target.id === 'cart-modal') closeCartDirect(); }
        function showToast(msg) {
            const t = document.getElementById('toast');
            t.innerText = msg; t.style.opacity = 1;
            setTimeout(() => t.style.opacity = 0, 1000);
        }

        // ==========================================
        // 5. Legal Modal Logic (Merged from necos.html)
        // ==========================================
        function fillLegalTexts(){
          const L = texts[state.lang];
          
          // Footer buttons
          const b1 = document.getElementById('footer-btn-legal');
          const b2 = document.getElementById('footer-btn-terms');
          const b3 = document.getElementById('footer-btn-returns');
          const b4 = document.getElementById('footer-btn-privacy');
          const b5 = document.getElementById('footer-btn-disputes');
          if (b1) b1.innerText = L.footerBtnLegal;
          if (b2) b2.innerText = L.footerBtnTerms;
          if (b3) b3.innerText = L.footerBtnReturns;
          if (b4) b4.innerText = L.footerBtnPrivacy;
          if (b5) b5.innerText = L.footerBtnDisputes;

          // Headings
          const ids = {
             'terms-h2-1': L.termsH2_1, 'terms-h2-2': L.termsH2_2, 'terms-h2-3': L.termsH2_3,
             'returns-h2-1': L.returnsH2_1, 'returns-h2-2': L.returnsH2_2,
             'privacy-h2-1': L.privacyH2_1, 'privacy-h2-2': L.privacyH2_2, 'privacy-h2-3': L.privacyH2_3, 'privacy-h2-4': L.privacyH2_4,
             'disputes-h2-1': L.disputesH2_1, 'disputes-h2-2': L.disputesH2_2,
             'legal-h2-scope': L.scopeH2, 'legal-h2-contacts': L.contactsH2,
             'legal-title': L.legalTitle
          };
          for(let k in ids) { const el = document.getElementById(k); if(el) el.innerText = ids[k]; }

          // Tabs
          document.querySelectorAll('.legal-tab').forEach(btn=>{
            const tab = btn.getAttribute('data-tab');
            btn.innerText = tab==='legal' ? L.tabLegal : tab==='terms' ? L.tabTerms : tab==='returns' ? L.tabReturns : tab==='privacy' ? L.tabPrivacy : tab==='disputes' ? L.tabDisputes : tab;
          });

          // Footer Note
          const y = new Date().getFullYear();
          const fy = document.getElementById('footer-year');
          if(fy) fy.innerText = y;
          const fn = document.getElementById('footer-note-text');
          if(fn) fn.innerText = (L.footerNote || '').replace('{year}', y);

          // Paragraphs & Ident
          const ident = document.getElementById('legal-kv-ident');
          if(ident){
            ident.innerHTML = `
              <div><b>${state.lang==='pt'?'Titular':'Owner'}:</b> ${safeText(LEGAL_INFO.ownerName)}</div>
              <div><b>${state.lang==='pt'?'Morada':'Address'}:</b> ${safeText(LEGAL_INFO.address)}</div>
              <div><b>${state.lang==='pt'?'IdentificaÃ§Ã£o Fiscal':'Tax ID'}:</b> ${safeText(LEGAL_INFO.taxId)}</div>
              <div><b>Email:</b> ${safeText(LEGAL_INFO.email)}</div>
              <div><b>${state.lang==='pt'?'Telefone':'Phone'}:</b> ${safeText(LEGAL_INFO.phone)}</div>
              <div><b>${state.lang==='pt'?'HorÃ¡rio':'Hours'}:</b> ${safeText(LEGAL_INFO.businessHours)}</div>
            `;
          }
          const pIds = {
            'legal-p-scope': L.scopeP, 'legal-p-contacts': L.contactsP,
            'terms-p-1': L.termsP1, 'terms-p-3': L.termsP3,
            'returns-muted': L.returnsMuted,
            'privacy-p-1': L.privacyP1, 'privacy-p-4': L.privacyP4,
            'disputes-p-1': L.disputesP1, 'disputes-p-2': L.disputesP2
          };
          for(let k in pIds) { const el = document.getElementById(k); if(el) el.innerText = pIds[k]; }

          // Lists
          const fillList = (id, arr) => {
             const ul = document.getElementById(id); if(!ul) return;
             ul.innerHTML = '';
             (arr||[]).forEach(x => {
                const li = document.createElement('li');
                li.innerText = x.replace('{deliveryArea}', safeText(LEGAL_INFO.deliveryArea))
                                .replace('{deliveryTime}', safeText(LEGAL_INFO.deliveryTime))
                                .replace('{deliveryFee}', safeText(LEGAL_INFO.deliveryFee));
                ul.appendChild(li);
             });
          };
          fillList('terms-list-2', L.termsList2);
          fillList('returns-list-1', L.returnsList1);
          fillList('returns-list-2', L.returnsList2);
          fillList('privacy-list-2', L.privacyList2);
          fillList('privacy-list-3', L.privacyList3);

          // ADR
          const adr = document.getElementById('legal-kv-adr');
          if(adr){
            adr.innerHTML = `
              <div><b>${state.lang==='pt'?'Entidade RAL':'ADR entity'}:</b> ${safeText(LEGAL_INFO.arbitrationEntity)}</div>
              <div><b>${state.lang==='pt'?'Website':'Website'}:</b> ${safeText(LEGAL_INFO.arbitrationWebsite)}</div>
              <div><b>ODR:</b> ${safeText(LEGAL_INFO.odrWebsite)}</div>
            `;
          }
        }

        function switchLegalTab(tab){
          __legalTab = tab;
          document.querySelectorAll('.legal-tab').forEach(b=>{ b.classList.toggle('active', b.getAttribute('data-tab')===tab); });
          document.querySelectorAll('.legal-section').forEach(sec=>{ sec.classList.remove('active'); });
          const sec = document.getElementById(`legal-section-${tab}`);
          if(sec) sec.classList.add('active');
        }

        function openLegalModal(tab='legal'){
          fillLegalTexts();
          switchLegalTab(tab);
          const modal = document.getElementById('legal-modal');
          const shell = document.getElementById('legal-shell');
          lockBodyScroll();
          modal.style.display = 'flex';
          modal.style.opacity = 1;
          requestAnimationFrame(()=> shell.classList.add('open'));
          history.pushState({ modal:true }, '');
        }

        function _hideLegalModal(){
          const modal = document.getElementById('legal-modal');
          const shell = document.getElementById('legal-shell');
          shell.classList.remove('open');
          modal.style.opacity = 0;
          setTimeout(()=>{ modal.style.display = 'none'; unlockBodyScrollIfNoModal(); }, 300);
        }
        function closeLegalDirect(){ _hideLegalModal(); }
        function closeLegalByOverlay(e){ if(e.target.id==='legal-modal') closeLegalDirect(); }

        // ===== æ‰‹æœºè¿”å›é”®æ‹¦æˆª =====
        window.addEventListener('popstate', function (e) {
          const productModal = document.getElementById('product-modal');
          if (productModal.style.display === 'flex') { _hideProductModal(); return; }
          const cartModal = document.getElementById('cart-modal');
          if (cartModal.style.display === 'flex') { _hideCartModal(); return; }
          const legalModal = document.getElementById('legal-modal');
          if (legalModal && legalModal.style.display === 'flex') { _hideLegalModal(); return; }
          // æ²¡æœ‰å¼¹çª—ï¼Œæ‰åšé¡µé¢çº§è¿”å›
          const isHome = document.getElementById('view-home').classList.contains('active');
          if (!isHome) { goBack(); return; }
        });
        
        init();
    </script>
</body>
</html>
